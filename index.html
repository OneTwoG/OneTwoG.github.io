<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <meta http-equiv="X-UA-Compatible" content="IE=edge" >
  <title>会飞的僵尸</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="个人博客">
<meta property="og:type" content="website">
<meta property="og:title" content="会飞的僵尸">
<meta property="og:url" content="http://ytwnoone.xyz/index.html">
<meta property="og:site_name" content="会飞的僵尸">
<meta property="og:description" content="个人博客">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="会飞的僵尸">
<meta name="twitter:description" content="个人博客">
  
    <link rel="alternative" href="/atom.xml" title="会飞的僵尸" type="application/atom+xml">
  
  
    <link rel="icon" href="//favicon.png">
  
  <link rel="stylesheet" href="/css/style.css">
</head>

<body>
  <div id="container">
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
	<header id="header" class="inner">
		<a href="/" class="profilepic">
			
			<img lazy-src="null/img/bolgHeader.jpg" class="js-avatar">
			
		</a>

		<hgroup>
		  <h1 class="header-author"><a href="/">会飞的僵尸</a></h1>
		</hgroup>

		
		<p class="header-subtitle">程序员改变世界，用代码分享快乐</p>
		

		
			<div class="switch-btn">
				<div class="icon">
					<div class="icon-ctn">
						<div class="icon-wrap icon-house" data-idx="0">
							<div class="birdhouse"></div>
							<div class="birdhouse_holes"></div>
						</div>
						<div class="icon-wrap icon-ribbon hide" data-idx="1">
							<div class="ribbon"></div>
						</div>
						
						<div class="icon-wrap icon-link hide" data-idx="2">
							<div class="loopback_l"></div>
							<div class="loopback_r"></div>
						</div>
						
						
						<div class="icon-wrap icon-me hide" data-idx="3">
							<div class="user"></div>
							<div class="shoulder"></div>
						</div>
						
					</div>
					
				</div>
				<div class="tips-box hide">
					<div class="tips-arrow"></div>
					<ul class="tips-inner">
						<li>Menu</li>
						<li>Tags</li>
						
						<li>Links</li>
						
						
						<li>About</li>
						
					</ul>
				</div>
			</div>
		

		<div class="switch-area">
			<div class="switch-wrap">
				<section class="switch-part switch-part1">
					<nav class="header-menu">
						<ul>
						
							<li><a href="/">主页</a></li>
				        
							<li><a href="/archives">所有文章</a></li>
				        
						</ul>
					</nav>
					<nav class="header-nav">
						<div class="social">
							
								<a class="github" target="_blank" href="#" title="github">github</a>
					        
								<a class="weibo" target="_blank" href="#" title="weibo">weibo</a>
					        
								<a class="rss" target="_blank" href="#" title="rss">rss</a>
					        
								<a class="zhihu" target="_blank" href="#" title="zhihu">zhihu</a>
					        
						</div>
					</nav>
				</section>
				
				
				<section class="switch-part switch-part2">
					<div class="widget tagcloud" id="js-tagcloud">
						
					</div>
				</section>
				
				
				
				<section class="switch-part switch-part3">
					<div id="js-friends">
					
			          <a target="_blank" class="main-nav-link switch-friends-link" href="http://localhost:4000/">奥巴马的博客</a>
			        
			          <a target="_blank" class="main-nav-link switch-friends-link" href="http://localhost:4000/">卡卡的美丽传说</a>
			        
			          <a target="_blank" class="main-nav-link switch-friends-link" href="http://localhost:4000/">本泽马的博客</a>
			        
			          <a target="_blank" class="main-nav-link switch-friends-link" href="http://localhost:4000/">吉格斯的博客</a>
			        
			          <a target="_blank" class="main-nav-link switch-friends-link" href="http://localhost:4000/">习大大大不同</a>
			        
			          <a target="_blank" class="main-nav-link switch-friends-link" href="http://localhost:4000/">托蒂的博客</a>
			        
			        </div>
				</section>
				

				
				
				<section class="switch-part switch-part4">
				
					<div id="js-aboutme">我是谁，我从哪里来，我到哪里去？我就是我，是颜色不一样的吃货…</div>
				</section>
				
			</div>
		</div>
	</header>				
</div>

    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
  	<div class="overlay">
  		<div class="slider-trigger"></div>
  		<h1 class="header-author js-mobile-header hide">会飞的僵尸</h1>
  	</div>
	<div class="intrude-less">
		<header id="header" class="inner">
			<div class="profilepic">
				
					<img lazy-src="null/img/bolgHeader.jpg" class="js-avatar">
				
			</div>
			<hgroup>
			  <h1 class="header-author">会飞的僵尸</h1>
			</hgroup>
			
			<p class="header-subtitle">程序员改变世界，用代码分享快乐</p>
			
			<nav class="header-menu">
				<ul>
				
					<li><a href="/">主页</a></li>
		        
					<li><a href="/archives">所有文章</a></li>
		        
		        <div class="clearfix"></div>
				</ul>
			</nav>
			<nav class="header-nav">
				<div class="social">
					
						<a class="github" target="_blank" href="#" title="github">github</a>
			        
						<a class="weibo" target="_blank" href="#" title="weibo">weibo</a>
			        
						<a class="rss" target="_blank" href="#" title="rss">rss</a>
			        
						<a class="zhihu" target="_blank" href="#" title="zhihu">zhihu</a>
			        
				</div>
			</nav>
		</header>				
	</div>
</nav>

      <div class="body-wrap">
  
    <article id="post-自定义ListView,实现Header缩放" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/09/10/自定义ListView,实现Header缩放/" class="article-date">
  	<time datetime="2016-09-10T09:55:20.156Z" itemprop="datePublished">2016-09-10</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/09/10/自定义ListView,实现Header缩放/">自定义ListView,实现Header缩放</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>本文章要实现的效果如图<br><img src="http://i.imgur.com/L9OwD6T.gif" alt=""></p>
<h2 id="分析"><a href="#分析" class="headerlink" title="分析"></a>分析</h2><p>主要用到了 overScrollBy() onScrollChanged() onTouchEvent(),还有一个自定义动画</p>
<h2 id="第一步"><a href="#第一步" class="headerlink" title="第一步"></a>第一步</h2><p>自定义ListView Header的布局，代码如下</p>
<pre><code>&lt;RelativeLayout xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;
    android:layout_width=&quot;match_parent&quot;
    android:layout_height=&quot;match_parent&quot;&gt;

&lt;ImageView
    android:id=&quot;@+id/imageView&quot;
    android:layout_width=&quot;match_parent&quot;
    android:layout_height=&quot;@dimen/defaultHeight&quot;
    android:src=&quot;@drawable/headerbackground&quot;
    android:scaleType=&quot;centerCrop&quot;/&gt;

&lt;ImageView
    android:id=&quot;@+id/icon&quot;
    android:layout_width=&quot;50dp&quot;
    android:layout_height=&quot;50dp&quot;
    android:layout_alignParentLeft=&quot;true&quot;
    android:layout_alignParentBottom=&quot;true&quot;
    android:layout_marginBottom=&quot;20dp&quot;
    android:layout_marginLeft=&quot;40dp&quot;
    android:src=&quot;@drawable/icon&quot; /&gt;
&lt;/RelativeLayout&gt;
</code></pre><h2 id="第二步实现自定义ListView"><a href="#第二步实现自定义ListView" class="headerlink" title="第二步实现自定义ListView"></a>第二步实现自定义ListView</h2><p>代码如下</p>
<pre><code>public class MyListView extends ListView {

    private int defaultHeight = 0;
    private ImageView backImage;
    private ImageView iconImage;
    private int rotateAngle = 0;

/*因为要在xml中定义，所以使用第二个构造函数*/
public MyListView(Context context, AttributeSet attrs) {
    super(context, attrs);
    this.defaultHeight = (int) context.getResources().getDimension(R.dimen.defaultHeight);
}

/*设置ListView头部的背景图片*/
public void setHeaderImageView(ImageView backImageView) {
    this.backImage = backImageView;
}

public void setHeaderIcon(ImageView iconImageView) {
    this.iconImage = iconImageView;
}

/**
 * 监听ListView的滑动过度
 *
 * @param deltaX
 * @param deltaY
 * @param scrollX
 * @param scrollY
 * @param scrollRangeX
 * @param scrollRangeY
 * @param maxOverScrollX
 * @param maxOverScrollY
 * @param isTouchEvent
 * @return
 */
@Override
protected boolean overScrollBy(int deltaX, int deltaY, int scrollX, int scrollY, int scrollRangeX, int scrollRangeY, int maxOverScrollX, int maxOverScrollY, boolean isTouchEvent) {

//        deltaX deltaY 增量
//        - ：代表下拉过度
//        + ：代表上拉过度
//        下拉的时候
    if (deltaY &lt; 0) {
        backImage.getLayoutParams().height = backImage.getHeight() - deltaY;
        //          设置头像旋转
        iconImage.setRotation(rotateAngle -= 10);
        backImage.requestLayout();
    } else {
//            缩小
        if (backImage.getHeight() &gt; defaultHeight) {
            backImage.getLayoutParams().height = backImage.getHeight() - deltaY;
            backImage.requestLayout();
        }
    }
    return super.overScrollBy(deltaX, deltaY, scrollX, scrollY, scrollRangeX, scrollRangeY, maxOverScrollX, maxOverScrollY, isTouchEvent);
}

/**
 * 上滑时让图片恢复大小
 *
 * @param l
 * @param t
 * @param oldl
 * @param oldt
 */
@Override
protected void onScrollChanged(int l, int t, int oldl, int oldt) {
    /*获取父容器*/
    View view = (View) backImage.getParent();

    if (view.getTop() &lt; 0 &amp;&amp; backImage.getHeight() &gt; defaultHeight) {
        backImage.getLayoutParams().height = backImage.getHeight() + view.getTop();
        view.layout(view.getLeft(), 0, view.getRight(), 0);
        backImage.requestLayout();
    }
    super.onScrollChanged(l, t, oldl, oldt);
}

/**
 * 松手时恢复高度
 *
 * @param ev
 * @return
 */
@Override
public boolean onTouchEvent(MotionEvent ev) {
    int action = ev.getAction();

    if (action == MotionEvent.ACTION_UP) {
        /*自定义动画恢复原来的高度*/
        ResetAnimation resetAnimation = new ResetAnimation(backImage, defaultHeight);
        resetAnimation.setDuration(1000);
        backImage.startAnimation(resetAnimation);
    }

    return super.onTouchEvent(ev);
}

public class ResetAnimation extends Animation {
    private final ImageView backImage;
    private final int targetHeight;
    private final int originalHeight;
    private final int extraHeight;

    public ResetAnimation(ImageView backImage, int targetHeight) {
        this.backImage = backImage;
        this.targetHeight = targetHeight;   //最终的高度
        this.originalHeight = backImage.getHeight();    //现在的高度
        this.extraHeight = originalHeight - targetHeight;   //高度差
    }

    @Override
    protected void applyTransformation(float interpolatedTime, Transformation t) {
        //interpolatedTime (0.0 - 1.0)执行的百分比
        //减小ImageView的高度
        //现在的高度减去高度差
        backImage.getLayoutParams().height = (int) (originalHeight - extraHeight * interpolatedTime);
        iconImage.setRotation(rotateAngle / interpolatedTime);
        backImage.requestLayout();
        super.applyTransformation(interpolatedTime, t);
        }
    }
}
</code></pre><h2 id="最后Activity如下"><a href="#最后Activity如下" class="headerlink" title="最后Activity如下"></a>最后Activity如下</h2><pre><code>    public class MainActivity extends AppCompatActivity {

    private MyListView myListView;
    private ImageView backImageView;
    private ImageView iconImageView;

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_main);

        myListView = (MyListView) findViewById(R.id.listView);

        /*渲染自定义view*/
        View view = View.inflate(this, R.layout.listview_header, null);
        /*获取自定义view里面的控件*/
        backImageView = (ImageView) view.findViewById(R.id.imageView);
        iconImageView = (ImageView) view.findViewById(R.id.icon);

        /*模拟数据*/
        ArrayAdapter&lt;String&gt; arrayAdapter = new ArrayAdapter&lt;String&gt;(this, android.R.layout.simple_list_item_1, new String[]{
                &quot;星期一 写代码&quot;,
                &quot;星期二 改bug&quot;,
                &quot;星期三 改需求&quot;,
                &quot;星期四 删代码&quot;,
                &quot;星期五 写代码&quot;,
                &quot;星期六 写代码&quot;,
                &quot;星期日 可以休息了&quot;
        });

        /*自定义ListView设置header图片*/
        myListView.addHeaderView(view);
        /*设置Header背景图片*/
        myListView.setHeaderImageView(backImageView);
        /*设置头像*/
        myListView.setHeaderIcon(iconImageView);
        myListView.setAdapter(arrayAdapter);
    }
}
</code></pre>
      
    </div>
    
    <div class="article-info article-info-index">
      
      
      
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/Android/">Android</a>
	</div>


      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-简单的天气APP" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/07/03/简单的天气APP/" class="article-date">
  	<time datetime="2016-07-03T12:26:47.937Z" itemprop="datePublished">2016-07-03</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/07/03/简单的天气APP/">简单的天气APP</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>学Android已经有一阵子了，通过这个项目实用一下自己学过的知识。</p>
<h3 id="程序整体分析"><a href="#程序整体分析" class="headerlink" title="程序整体分析"></a>程序整体分析</h3><ul>
<li>主要有两个活动，一个用来选择查看天气的Activity，另一个用来显示所选的地方当前天气的Activity</li>
<li>使用本地数据SQLite做数据本地化（主要存储地方的代号和名称）</li>
<li>使用后台服务定时更新天气信息</li>
</ul>
<h3 id="两个界面的XML"><a href="#两个界面的XML" class="headerlink" title="两个界面的XML"></a>两个界面的XML</h3><p>选择查询天气地点的界面<br>    &lt;?xml version=”1.0” encoding=”utf-8”?&gt;<br>    <linearlayout xmlns:android="http://schemas.android.com/apk/res/android" android:layout_width="match_parent" android:layout_height="match_parent" android:orientation="vertical"></linearlayout></p>
<pre><code>&lt;RelativeLayout
    android:layout_width=&quot;match_parent&quot;
    android:layout_height=&quot;50dp&quot;
    android:background=&quot;@color/colorPrimaryDark&quot;&gt;

    &lt;TextView
        android:id=&quot;@+id/title_text&quot;
        android:layout_width=&quot;wrap_content&quot;
        android:layout_height=&quot;wrap_content&quot;
        android:layout_centerInParent=&quot;true&quot;
        android:textColor=&quot;#fff&quot;
        android:textSize=&quot;24sp&quot;/&gt;
&lt;/RelativeLayout&gt;

&lt;ListView
    android:id=&quot;@+id/lv_view&quot;
    android:layout_width=&quot;match_parent&quot;
    android:layout_height=&quot;match_parent&quot;&gt;&lt;/ListView&gt;
&lt;/LinearLayout&gt;
</code></pre><p>该界面简单比较简单，第一个TextView用于显示所选地方所属的区域。ListView用于显示这个区域下所有的子区域。</p>
<p>显示当前区域天气的XML<br>    &lt;?xml version=”1.0” encoding=”utf-8”?&gt;<br>    <linearlayout xmlns:android="http://schemas.android.com/apk/res/android" android:layout_width="match_parent" android:layout_height="match_parent" android:orientation="vertical"></linearlayout></p>
<pre><code>&lt;RelativeLayout
    android:layout_width=&quot;match_parent&quot;
    android:layout_height=&quot;50dp&quot;
    android:background=&quot;@color/colorPrimaryDark&quot;&gt;

    &lt;Button
        android:id=&quot;@+id/switch_city&quot;
        android:layout_width=&quot;30dp&quot;
        android:layout_height=&quot;30dp&quot;
        android:layout_centerVertical=&quot;true&quot;
        android:layout_marginLeft=&quot;10dp&quot;
        android:background=&quot;@drawable/ic_menu_home&quot;/&gt;
    &lt;TextView
        android:id=&quot;@+id/tv_city_name&quot;
        android:layout_width=&quot;wrap_content&quot;
        android:layout_height=&quot;wrap_content&quot;
        android:layout_centerInParent=&quot;true&quot;
        android:textSize=&quot;24sp&quot;
        android:textColor=&quot;#fff&quot;/&gt;
    &lt;Button
        android:id=&quot;@+id/refresh_weather&quot;
        android:layout_width=&quot;30dp&quot;
        android:layout_height=&quot;30dp&quot;
        android:layout_alignParentRight=&quot;true&quot;
        android:layout_centerVertical=&quot;true&quot;
        android:layout_marginRight=&quot;10dp&quot;
        android:background=&quot;@drawable/ic_popup_sync_1&quot;/&gt;
&lt;/RelativeLayout&gt;

&lt;RelativeLayout
    android:layout_width=&quot;match_parent&quot;
    android:layout_height=&quot;0dp&quot;
    android:layout_weight=&quot;1&quot;
    android:background=&quot;#27A5F9&quot;&gt;

    &lt;TextView
        android:id=&quot;@+id/tv_publish_time&quot;
        android:layout_width=&quot;wrap_content&quot;
        android:layout_height=&quot;wrap_content&quot;
        android:textColor=&quot;#fff&quot;
        android:textSize=&quot;18sp&quot;
        android:layout_marginRight=&quot;10dp&quot;
        android:layout_marginTop=&quot;10dp&quot;
        android:layout_alignParentRight=&quot;true&quot; /&gt;

    &lt;LinearLayout
        android:id=&quot;@+id/layout_weather_info&quot;
        android:layout_width=&quot;wrap_content&quot;
        android:layout_height=&quot;wrap_content&quot;
        android:layout_centerInParent=&quot;true&quot;
        android:orientation=&quot;vertical&quot;&gt;

        &lt;ImageView
            android:id=&quot;@+id/icon_weather&quot;
            android:layout_width=&quot;50dp&quot;
            android:layout_height=&quot;50dp&quot;
            android:src=&quot;@drawable/logo&quot;
            android:layout_gravity=&quot;center&quot;/&gt;

        &lt;TextView
            android:id=&quot;@+id/tv_current_date&quot;
            android:layout_width=&quot;wrap_content&quot;
            android:layout_height=&quot;40dp&quot;
            android:gravity=&quot;center&quot;
            android:textColor=&quot;#fff&quot;
            android:textSize=&quot;18sp&quot; /&gt;

        &lt;TextView
            android:id=&quot;@+id/tv_weather_desp&quot;
            android:layout_width=&quot;wrap_content&quot;
            android:layout_height=&quot;60dp&quot;
            android:layout_gravity=&quot;center_horizontal&quot;
            android:gravity=&quot;center&quot;
            android:textColor=&quot;#FFF&quot;
            android:textSize=&quot;40sp&quot;/&gt;

        &lt;LinearLayout
            android:layout_width=&quot;wrap_content&quot;
            android:layout_height=&quot;60dp&quot;
            android:layout_gravity=&quot;center_horizontal&quot;
            android:orientation=&quot;horizontal&quot;&gt;

            &lt;TextView
                android:id=&quot;@+id/tv_temp1&quot;
                android:layout_width=&quot;wrap_content&quot;
                android:layout_height=&quot;wrap_content&quot;
                android:layout_gravity=&quot;center_vertical&quot;
                android:textColor=&quot;#FFF&quot;
                android:textSize=&quot;40sp&quot; /&gt;

            &lt;TextView
                android:layout_width=&quot;wrap_content&quot;
                android:layout_height=&quot;wrap_content&quot;
                android:layout_gravity=&quot;center_vertical&quot;
                android:layout_marginLeft=&quot;10dp&quot;
                android:layout_marginTop=&quot;10dp&quot;
                android:gravity=&quot;center&quot;
                android:textColor=&quot;#fff&quot;
                android:textSize=&quot;40sp&quot;
                android:text=&quot;~~&quot;/&gt;

            &lt;TextView
                android:id=&quot;@+id/tv_temp2&quot;
                android:layout_width=&quot;wrap_content&quot;
                android:layout_height=&quot;wrap_content&quot;
                android:layout_gravity=&quot;center_vertical&quot;
                android:textColor=&quot;#fff&quot;
                android:textSize=&quot;40sp&quot;/&gt;
        &lt;/LinearLayout&gt;
    &lt;/LinearLayout&gt;
&lt;/RelativeLayout&gt;
&lt;/LinearLayout&gt;
</code></pre><h3 id="实现主要功能的Java类"><a href="#实现主要功能的Java类" class="headerlink" title="实现主要功能的Java类"></a>实现主要功能的Java类</h3><p>选择区域Activity类<br>    package activity;</p>
<pre><code>import android.app.Activity;
import android.app.ProgressDialog;
import android.content.Intent;
import android.content.SharedPreferences;
import android.os.Bundle;
import android.preference.PreferenceManager;
import android.text.TextUtils;
import android.util.Log;
import android.view.View;
import android.view.Window;
import android.widget.AdapterView;
import android.widget.ArrayAdapter;
import android.widget.ListView;
import android.widget.TextView;
import android.widget.Toast;

import com.example.t.coolwheather.R;

import java.util.ArrayList;
import java.util.List;

import db.CoolWeatherOpenHelper;
import model.City;
import model.CoolWeatherDB;
import model.County;
import model.Province;
import util.HttpCallbackListener;
import util.HttpUtil;
import util.Utility;

/**
 * Created by T on 2016/4/7.
 */
public class ChooseAreaActivity extends Activity {

    public static final int LEVEL_PROVINCE = 0;
    public static final int LEVEL_CITY = 1;
    public static final int LEVEL_COUNTY = 2;

    private ProgressDialog progressDialog;
    private TextView titleText;
    private ListView areaListView;
    private ArrayAdapter&lt;String&gt; adapter;
    private CoolWeatherDB coolWeatherDB;
    private List&lt;String&gt; dataList = new ArrayList&lt;String&gt;();

    private List&lt;Province&gt; provinceList;//省列表
    private List&lt;City&gt; cityList;//市列表
    private List&lt;County&gt; countyList;//县列表

    private Province selectedProvince;//选中的省份
    private City selectedCity;//选中的城市
    private County selectedCounty;//选中的县

    private int currentLevel;//当前选中的级别

    private boolean isFromWeatherActivity;      //是否从WeatherActivity跳转过来

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);

        requestWindowFeature(Window.FEATURE_NO_TITLE);
        setContentView(R.layout.choose_area);

        isFromWeatherActivity = getIntent().getBooleanExtra(&quot;from_weather_activity&quot;, false);

        SharedPreferences prefs = PreferenceManager.getDefaultSharedPreferences(this);
        if (prefs.getBoolean(&quot;city_selected&quot;, false) &amp;&amp; !isFromWeatherActivity){
            Log.d(&quot;Choose&quot;, &quot;onCreate: &quot; + &quot;测试&quot;);
            Intent intent = new Intent(this, WeatherActivity.class);
            startActivity(intent);
            finish();
            return;
        }

        initView();//初始化各种控件

        areaListView.setOnItemClickListener(new AdapterView.OnItemClickListener() {
            @Override
            public void onItemClick(AdapterView&lt;?&gt; parent, View view, int position, long id) {
                if (currentLevel == LEVEL_PROVINCE){//如果当前选择是省级
                    selectedProvince = provinceList.get(position);//实例化Province对象，并获取到点击到的对象

                    queryCities();
                }else if (currentLevel == LEVEL_CITY){
                    selectedCity = cityList.get(position);//实例化City对象，并获取到点击到的对象
                    queryCounties();
                }else if (currentLevel == LEVEL_COUNTY){
                    String countyCode = countyList.get(position).getCountyCode();
                    Intent intent = new Intent(ChooseAreaActivity.this, WeatherActivity.class);
                    intent.putExtra(&quot;county_code&quot;, countyCode);
                    startActivity(intent);
                    finish();
                }
            }
        });
        queryProvince();
    }

    /**
     * 捕获back按键，根据当前的级别来判断，此时应该返回市列表，省列表，还是直接退出
     */
    @Override
    public void onBackPressed() {
        if (currentLevel == LEVEL_COUNTY){
            queryCities();
        }else if (currentLevel == LEVEL_CITY){
            queryProvince();
        }else {
            if (isFromWeatherActivity){
                Intent intent = new Intent(this, WeatherActivity.class);
                startActivity(intent);
            }
            finish();
        }
    }

    private void queryProvince() {
        provinceList = coolWeatherDB.loadProvinces();

        if (provinceList.size() &gt; 0){
            dataList.clear();
            for (Province p : provinceList){
                dataList.add(p.getProvinceName());//从数据库中读取全国所有的省份
            }
            adapter.notifyDataSetChanged();
            areaListView.setSelection(0);
            titleText.setText(&quot;中国&quot;);
            currentLevel = LEVEL_PROVINCE;
        }else {//否则从服务器中查询
            queryFromServer(null, &quot;province&quot;);
        }
    }

    /**
     * 查询选中市所有的县，有限从数据库查询，如果没有再到服务器查询
     */
    private void queryCounties() {
        countyList = coolWeatherDB.loadCounty(selectedCity.getId());//从数据库中获取选中市所有的县的集合

        if (countyList.size() &gt; 0){
            dataList.clear();//先清空之前存储的市级的数据
            for (County c : countyList){
                dataList.add(c.getCountyName());//将市所有的县名称添加到dataList中
            }
            adapter.notifyDataSetChanged();
            areaListView.setSelection(0);
            titleText.setText(selectedCity.getCityName());
            currentLevel = LEVEL_COUNTY;
        }else {
            //否则从服务器中查询
            queryFromServer(selectedCity.getCityCode(), &quot;county&quot;);
        }
    }

    /**
     * 查询选中省的所有市，优先从数据库查询，如果没有再到服务器上查询
     */
    private void queryCities() {
        cityList = coolWeatherDB.loadCity(selectedProvince.getId());

        if (cityList.size() &gt; 0){
            dataList.clear();//先清空之前存储的省份的数据
            for (City c : cityList){
                dataList.add(c.getCityName());
            }

            adapter.notifyDataSetChanged();
            areaListView.setSelection(0);
            titleText.setText(selectedProvince.getProvinceName());
            currentLevel = LEVEL_CITY;
        }else {
            //否则从服务器中查询
            queryFromServer(selectedProvince.getProvinceCode(), &quot;city&quot;);
        }
    }

    /**
     * 根据传入的代号和类型从服务器上查询省市县数据
     * @param code
     * @param type
     */
    private void queryFromServer(final String code, final String type) {
        String address;
        if (!TextUtils.isEmpty(code)){
            //如果code不为空，则返回的是省内所有的市
            address = &quot;http://www.weather.com.cn/data/list3/city&quot; + code + &quot;.xml&quot;;
        }else {
            //如果code为空，则返回的是全国各省的数据
            address = &quot;http://www.weather.com.cn/data/list3/city.xml&quot;;
        }
        showProgressDialog();

        /**
         * 调用sendHttpRequest() 从服务器获取数据
         */
        HttpUtil.sendHttpRequest(address, new HttpCallbackListener() {
            @Override
            public void onFinish(String response) {
                boolean result = false;

                if (&quot;province&quot;.equals(type)){
                    result = Utility.handleProvincesResponse(coolWeatherDB, response);//将数据存储到本地数据库
                }else if (&quot;city&quot;.equals(type)){
                    result = Utility.handlerCitiesResponse(coolWeatherDB, response, selectedProvince.getId());//将数据存储到本地数据库
                }else if (&quot;county&quot;.equals(type)){
                    result = Utility.handlerCounties(coolWeatherDB, response, selectedCity.getId());//将数据存储到本地数据库
                }

                if (result){
                    //通过runOnUiThread()方法回到主线程处理逻辑
                    runOnUiThread(new Runnable() {
                        @Override
                        public void run() {
                            closeProgressDialog();
                            if (&quot;province&quot;.equals(type)){
                                queryProvince();//从本地数据库读取数据
                            }else if (&quot;city&quot;.equals(type)){
                                queryCities();//从本地数据库读取数据
                            }else if (&quot;county&quot;.equals(type)){
                                queryCounties();//从本地数据库读取数据
                        }
                        }
                    });
                }
            }

            @Override
            public void onError(Exception e) {
                runOnUiThread(new Runnable() {
                    @Override
                    public void run() {
                        closeProgressDialog();
                        Toast.makeText(ChooseAreaActivity.this, &quot;加载失败&quot;, Toast.LENGTH_SHORT).show();
                    }
                });
            }
        });
    }

    /**
     * 关闭进度对话框
     */
    private void closeProgressDialog() {
        if (progressDialog != null){
            progressDialog.dismiss();
        }
    }

    /**
     * 显示进度对话框
     */
    private void showProgressDialog() {
        if (progressDialog == null){
            progressDialog = new ProgressDialog(this);
            progressDialog.setMessage(&quot;正在加载....&quot;);
            progressDialog.setCanceledOnTouchOutside(false);
        }
        progressDialog.show();
    }

    private void initView() {
        areaListView = (ListView) findViewById(R.id.lv_view);
        titleText = (TextView) findViewById(R.id.title_text);
        adapter = new ArrayAdapter&lt;String&gt;(this, android.R.layout.simple_list_item_1, dataList);
        areaListView.setAdapter(adapter);
        coolWeatherDB = CoolWeatherDB.getInstance(this);//获取CoolWeatherDB对象实例
    }
}
</code></pre><p>显示当前天气的Activity类</p>
<pre><code>package activity;

import android.app.Activity;
import android.content.Intent;
import android.content.SharedPreferences;
import android.graphics.Bitmap;
import android.graphics.BitmapFactory;
import android.os.Bundle;
import android.os.Handler;
import android.os.Message;
import android.preference.PreferenceManager;
import android.text.TextUtils;
import android.util.Log;
import android.view.View;
import android.widget.Button;
import android.widget.ImageView;
import android.widget.LinearLayout;
import android.widget.TextView;

import com.example.t.coolwheather.R;

import java.io.BufferedInputStream;
import java.io.InputStream;
import java.net.URL;
import java.net.URLConnection;

import service.AutoUpdateService;
import util.HttpCallbackListener;
import util.HttpUtil;
import util.Utility;

import static com.example.t.coolwheather.R.id.tv_temp1;

/**
 * Created by T on 2016/4/13.
 */
public class WeatherActivity extends Activity implements View.OnClickListener {

    private LinearLayout weatherInfoLayout;
    private TextView cityTextName;//用于显示城市的名称
    private TextView publishText;//用于显示发布时间
    private TextView weatherDespText;//用于显示天气描述信息
    private TextView temp1Text;//用于显示气温1
    private TextView temp2Text;//用于显示气温2
    private TextView currentDatetext;//用于显示当前时间

    private Button switchCity;      //用于切换城市
    private Button refreshWeather;      //更新天气按钮

    private ImageView iconWeather;      //天气图标
    private Bitmap bm = null;// 生成了一张bmp图像

    private String imgAddress = &quot;http://m.weather.com.cn/img/&quot;;

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.weather_layout);

        initView();//初始化

        switchCity.setOnClickListener(this);        //切换城市按钮监听事件
        refreshWeather.setOnClickListener(this);    //刷新监听事件

        String countyCode = getIntent().getStringExtra(&quot;county_code&quot;);//获取从ChooseActivity传过来的county_code
        //对countyCode进行判断
        if (!TextUtils.isEmpty(countyCode)) {
            //有县级代号就查询天气
            publishText.setText(&quot;同步中....&quot;);

            weatherInfoLayout.setVisibility(View.INVISIBLE);//将weatherInfoLayout布局先隐藏
            cityTextName.setVisibility(View.INVISIBLE);//将cityName控件隐藏

            queryWeatherCode(countyCode);
        } else {
            //没有县级代号就显示本地天气
            showWeather();
        }
    }

    /**
     * 查询县级代号所对应的天气代号
     *
     * @param countyCode
     */
    private void queryWeatherCode(String countyCode) {
        String address = &quot;http://www.weather.com.cn/data/list3/city&quot; + countyCode + &quot;.xml&quot;;
        queryForServer(address, &quot;countyCode&quot;);
    }

    /**
     * 查询天气代号所对应的天气
     *
     * @param weatherCode
     */
    private void queryWeatherInfo(String weatherCode) {
        String address = &quot;http://www.weather.com.cn/data/cityinfo/&quot; + weatherCode + &quot;.html&quot;;
        queryForServer(address, &quot;weatherCode&quot;);//从服务器查询天气
    }

    /**
     * 根据传入的地址和类型去向服务器查询天气代号或者天气信息
     *
     * @param address
     * @param type
     */
    private void queryForServer(final String address, final String type) {
//        Log.d(&quot;WeatherActivity---&gt;&quot;, address);
        HttpUtil.sendHttpRequest(address, new HttpCallbackListener() {
            @Override
            public void onFinish(final String response) {
                Log.d(&quot;WeatherActivity---&gt;&quot;, response);
                if (&quot;countyCode&quot;.equals(type)) {
                    if (!TextUtils.isEmpty(response)) {
                        //从服务器返回的数据中解析出天气代号
                        //解析出来的数据实例为  县级名称|天气代号
                        String[] array = response.split(&quot;\\|&quot;);
                        if (array != null &amp;&amp; array.length == 2) {
                            String weatherCode = array[1];//拿到天气代号
                            queryWeatherInfo(weatherCode);
                        }
                    }
                } else if (&quot;weatherCode&quot;.equals(type)) {
                    Log.v(&quot;返回的json是---&gt;&quot;, response);
                    //处理服务器返回的天气信息
                    Utility.handlerWeatherResponse(WeatherActivity.this, response);
                    runOnUiThread(new Runnable() {
                        @Override
                        public void run() {
                            showWeather();
                        }
                    });
                }
            }

            @Override
            public void onError(Exception e) {
                runOnUiThread(new Runnable() {
                    @Override
                    public void run() {
                        publishText.setText(&quot;同步失败&quot;);
                        showWeather();
                    }
                });
            }
        });
    }

    /**
     * 从SharedPreference文件中读取存储的天气信息，并显示到界面上
     */
    private void showWeather() {

//        queryForServer(address, &quot;weatherCode&quot;);//从服务器查询天气
        SharedPreferences preds = PreferenceManager.getDefaultSharedPreferences(this);

        cityTextName.setText(preds.getString(&quot;city_name&quot;, &quot;&quot;));
        temp1Text.setText(preds.getString(&quot;temp1&quot;, &quot;&quot;));
        temp2Text.setText(preds.getString(&quot;temp2&quot;, &quot;&quot;));

        Log.d(&quot;test&quot;, &quot;showWeather: &quot; + preds.getString(&quot;weather_desp&quot;, &quot;&quot;));
        weatherDespText.setText(preds.getString(&quot;weather_desp&quot;, &quot;&quot;));
        publishText.setText(&quot;今天&quot; + preds.getString(&quot;publish_time&quot;, &quot;&quot;) + &quot;发布&quot;);

        currentDatetext.setText(preds.getString(&quot;current_time&quot;, &quot;&quot;));

        weatherInfoLayout.setVisibility(View.VISIBLE);//将weatherInfoLayout设置为可见
        currentDatetext.setVisibility(View.VISIBLE);    //将时间显示可见
        cityTextName.setVisibility(View.VISIBLE);   //将citytextName设置为可见

        Intent intent = new Intent(this, AutoUpdateService.class);
        startService(intent);

        String img = preds.getString(&quot;img&quot;, &quot;&quot;);

        setBitmap(preds);
    }

    private void setBitmap(SharedPreferences preds) {
        final SharedPreferences predss = preds;
        new Thread() {
            @Override
            public void run() {
                getBiamapFromServer(imgAddress + predss.getString(&quot;img&quot;, &quot;&quot;));
            }
        }.start();
    }

    private Bitmap getBiamapFromServer(String img) {
        try {
            URL iconurl = new URL(img);
            URLConnection conn = iconurl.openConnection();
            conn.connect();
            // 获得图像的字符流
            InputStream is = conn.getInputStream();
            BufferedInputStream bis = new BufferedInputStream(is, 1024);
            bm = BitmapFactory.decodeStream(bis);
            bis.close();
            is.close();// 关闭流
            handler.sendEmptyMessage(0);
        } catch (Exception e) {
            e.printStackTrace();
        }
        return bm;
    }

    Handler handler = new Handler() {
        @Override
        public void handleMessage(Message msg) {
            switch (msg.what) {
                case 0:
                    iconWeather.setImageBitmap(bm);
                    break;
            }
        }
    };

    private void initView() {
        weatherInfoLayout = (LinearLayout) findViewById(R.id.layout_weather_info);
        cityTextName = (TextView) findViewById(R.id.tv_city_name);
        publishText = (TextView) findViewById(R.id.tv_publish_time);
        weatherDespText = (TextView) findViewById(R.id.tv_weather_desp);
        temp1Text = (TextView) findViewById(tv_temp1);
        temp2Text = (TextView) findViewById(R.id.tv_temp2);
        currentDatetext = (TextView) findViewById(R.id.tv_current_date);
        switchCity = (Button) findViewById(R.id.switch_city);
        refreshWeather = (Button) findViewById(R.id.refresh_weather);
        iconWeather = (ImageView) findViewById(R.id.icon_weather);
    }

    @Override
    public void onClick(View v) {
        switch (v.getId()) {
            case R.id.switch_city:
                Intent intent = new Intent(this, ChooseAreaActivity.class);
                intent.putExtra(&quot;from_weather_activity&quot;, true);
                startActivity(intent);
                finish();
                break;
            case R.id.refresh_weather:
                publishText.setText(&quot;同步中....&quot;);
                SharedPreferences prefs = PreferenceManager.getDefaultSharedPreferences(this);
                String weatherCode = prefs.getString(&quot;weather_code&quot;, &quot;&quot;);
                if (!TextUtils.isEmpty(weatherCode)) {
                    queryWeatherInfo(weatherCode);
                }
                break;
            default:
                break;
        }
    }
}
</code></pre><h3 id="建立数据库的类"><a href="#建立数据库的类" class="headerlink" title="建立数据库的类"></a>建立数据库的类</h3><pre><code>package db;

import android.content.Context;
import android.database.sqlite.SQLiteDatabase;
import android.database.sqlite.SQLiteOpenHelper;

/**
 * Created by T on 2016/4/7.
 */
public class CoolWeatherOpenHelper extends SQLiteOpenHelper {

    /***
     * Province建表语句
     */
    public static final String CREATE_PROVINCE = &quot;create table Province&quot; + &quot;(id integer primary key autoincrement, &quot;
                                                + &quot;province_name text, &quot;
                                                + &quot;province_code text)&quot;;

    /***
     * City建表语句
     */
    public static final String CREATE_CITY = &quot;create table City&quot; + &quot;(id integer primary key autoincrement, &quot;
                                                + &quot;city_name text, &quot;
                                                + &quot;city_code text, &quot;
                                                + &quot;province_id integer)&quot;;

    /***
     * County建表语句
     */
    public static final String CREATE_COUNTY = &quot;create table County&quot; + &quot;(id integer primary key autoincrement, &quot;
                                                + &quot;county_name text, &quot;
                                                + &quot;county_code text, &quot;
                                                + &quot;city_id integer)&quot;;

    public CoolWeatherOpenHelper(Context context, String name, SQLiteDatabase.CursorFactory factory, int version) {
        super(context, name, factory, version);
    }

    /***
     * 在onCreate()方法里面执行建表
     * @param db
     */
    @Override
    public void onCreate(SQLiteDatabase db) {
        db.execSQL(CREATE_PROVINCE);
        db.execSQL(CREATE_CITY);//创建City表
        db.execSQL(CREATE_COUNTY);//创建County表
    }

    @Override
    public void onUpgrade(SQLiteDatabase db, int oldVersion, int newVersion) {
    }
}
</code></pre><h3 id="读写本地数据库的类"><a href="#读写本地数据库的类" class="headerlink" title="读写本地数据库的类"></a>读写本地数据库的类</h3><pre><code>package model;

import android.content.ContentValues;
import android.content.Context;
import android.database.Cursor;
import android.database.sqlite.SQLiteDatabase;
import android.util.Log;

import java.util.ArrayList;
import java.util.List;

import db.CoolWeatherOpenHelper;

/**
 * 该类主要封装了一些常用的数据库操作
 * Created by T on 2016/4/7.
 */
public class CoolWeatherDB {

    /**
     * 数据库名称
     */
    public static final String DB_NAME = &quot;cool_weather&quot;;

    /**
     * 数据库版本
     */
    public static final int VERSION = 1;

    /**
     * 创建CoolWeatherDB SQLiteDatabase 对象
     */
    public static CoolWeatherDB coolWeatherDB;
    private SQLiteDatabase db;

    /**
     * 创建一个构造方法，并私有化
     *
     * @param context
     */
    private CoolWeatherDB(Context context) {
        //创建一个CoolWeatherOpenHelper对象
        CoolWeatherOpenHelper coolWeatherOpenHelper = new CoolWeatherOpenHelper(context, DB_NAME, null, VERSION);

        //执行getWritableDatabase()方法,获得一个SQLiteDatabase对象
        db = coolWeatherOpenHelper.getWritableDatabase();
    }

    /**
     * 获取CoolWeatherDB的实例
     *
     * @param context
     * @return
     */
    public synchronized static CoolWeatherDB getInstance(Context context) {

        if (coolWeatherDB == null) {
            coolWeatherDB = new CoolWeatherDB(context);
        }

        return coolWeatherDB;
    }

    /**
     * 将Province实例存储到数据库
     *
     * @param province
     */
    public void saveProvince(Province province) {

        if (province != null) {
            ContentValues values = new ContentValues();
            values.put(&quot;province_name&quot;, province.getProvinceName());
            values.put(&quot;province_code&quot;, province.getProvinceCode());
            db.insert(&quot;Province&quot;, null, values);
        }
    }

    /**
     * 从数据库中读取全国所有的省份信息
     *
     * @return
     */
    public List&lt;Province&gt; loadProvinces() {

        List&lt;Province&gt; list = new ArrayList&lt;Province&gt;();

        //执行数据库查询语句，并接收返回的结果
        Cursor cursor = db.query(&quot;Province&quot;, null, null, null, null, null, null);

        if (cursor.moveToFirst()) {
            do {
                //创建一个Province对象
                Province province = new Province();
                province.setId(cursor.getInt(cursor.getColumnIndex(&quot;id&quot;)));//获取id列的值
                province.setProvinceName(cursor.getString(cursor.getColumnIndex(&quot;province_name&quot;)));//获取province_name列的值
                province.setProvinceCode(cursor.getString(cursor.getColumnIndex(&quot;province_code&quot;)));//获取province_code列的值

                //将读取出来的每个Province对象添加到List
                list.add(province);
            } while (cursor.moveToNext());
        }

        if (cursor != null) {
            cursor.close();
        }
        return list;
    }

    /**
     * 将City实例存储到数据库
     *
     * @param city
     */
    public void saveCity(City city) {

        if (city != null) {
            ContentValues values = new ContentValues();
            values.put(&quot;city_name&quot;, city.getCityName());
            values.put(&quot;city_code&quot;, city.getCityCode());
            values.put(&quot;province_id&quot;, city.getProvinceId());

            //执行数据库插入操作
            db.insert(&quot;City&quot;, null, values);
        }
    }

    /**
     * 从数据库 读取某省下所有的城市的信息
     *
     * @param provinceId 外键,所要查询省份的ID
     * @return
     */
    public List&lt;City&gt; loadCity(int provinceId) {
        //创建一个集合对象
        List&lt;City&gt; list = new ArrayList&lt;City&gt;();

        Log.v(&quot;provinceId---&gt;&quot;, provinceId + &quot;&quot;);

        //执行数据库查询操作，并接收返回的数据
        Cursor cursor = db.query(&quot;City&quot;, null, &quot;province_id = ?&quot;, new String[]{String.valueOf(provinceId)}, null, null, null);

//        Cursor cursor = db.query(&quot;City&quot;, null, null, null, null, null, null);
        if (cursor.moveToFirst()) {
            do {
                //创建一个City对象接收数据
                City city = new City();
                city.setId(cursor.getInt(cursor.getColumnIndex(&quot;id&quot;)));
                city.setCityName(cursor.getString(cursor.getColumnIndex(&quot;city_name&quot;)));
                city.setCityCode(cursor.getString(cursor.getColumnIndex(&quot;city_code&quot;)));
                city.setProvinceId(provinceId);

                //将city对象添加到List集合
                list.add(city);
            } while (cursor.moveToNext());
        }

        if (cursor != null) {
            cursor.close();
        }
        return list;
    }

    /**
     * 将County实例存储到数据库中
     *
     * @param county
     */
    public void saveCounty(County county) {

        if (county != null) {
            ContentValues values = new ContentValues();
            values.put(&quot;county_name&quot;, county.getCountyName());
            values.put(&quot;county_code&quot;, county.getCountyCode());
            values.put(&quot;city_id&quot;, county.getCityId());

            //执行数据库插入操作
            db.insert(&quot;County&quot;, null, values);
        }
    }

    /**
     * 从数据库中读取某城市下所有县的信息
     *
     * @param cityId
     * @return
     */
    public List&lt;County&gt; loadCounty(int cityId) {
        //创建一个List集合，用于存放County实例
        List&lt;County&gt; list = new ArrayList&lt;County&gt;();

        //执行数据库查询操作，并用Cursor接收返回的数据
        Cursor cursor = db.query(&quot;County&quot;, null, &quot;city_id   = ?&quot;, new String[]{String.valueOf(cityId)}, null, null, null);

        if (cursor.moveToFirst()){
            do {
                //创建County实例，用于存储从数据库读取出来的数据
                County county = new County();
                county.setId(cursor.getInt(cursor.getColumnIndex(&quot;id&quot;)));
                county.setCountyName(cursor.getString(cursor.getColumnIndex(&quot;county_name&quot;)));
                county.setCountyCode(cursor.getString(cursor.getColumnIndex(&quot;county_code&quot;)));
                county.setCityId(cityId);

                //将读取出来的county实例对象添加到List
                list.add(county);
            }while (cursor.moveToNext());
        }

        if (cursor != null) {
            cursor.close();
        }

        return list;
    }
}
</code></pre><h3 id="自动更新天气信息的服务类"><a href="#自动更新天气信息的服务类" class="headerlink" title="自动更新天气信息的服务类"></a>自动更新天气信息的服务类</h3><pre><code>package service;

import android.app.AlarmManager;
import android.app.PendingIntent;
import android.app.Service;
import android.content.Intent;
import android.content.SharedPreferences;
import android.os.IBinder;
import android.os.SystemClock;
import android.preference.PreferenceManager;
import android.support.annotation.Nullable;

import util.HttpCallbackListener;
import util.HttpUtil;
import util.Utility;

/**
 * Created by T on 2016/7/1.
 */

public class AutoUpdateService extends Service {
    @Nullable
    @Override
    public IBinder onBind(Intent intent) {
        return null;
    }

    @Override
    public int onStartCommand(Intent intent, int flags, int startId) {
        new Thread(){
            @Override
            public void run() {
                updateWeather();
            }
        }.start();
        AlarmManager manager = (AlarmManager) getSystemService(ALARM_SERVICE);
        int anHour = 4 * 60 * 60 * 1000;        //四小时的毫秒数
        long triggerAtTime = SystemClock.elapsedRealtime() + anHour;

        Intent i = new Intent(this, AutoUpdateReceiver.class);
        PendingIntent pi = PendingIntent.getBroadcast(this, 0 , i ,0);
        manager.set(AlarmManager.ELAPSED_REALTIME_WAKEUP, triggerAtTime, pi);

        return super.onStartCommand(intent, flags, startId);
    }

    /**
     * 更新天气信息
     */
    private void updateWeather() {
        SharedPreferences prefs = PreferenceManager.getDefaultSharedPreferences(this);
        String weatherCode = prefs.getString(&quot;weather_code&quot;, &quot;&quot;);
        String address = &quot;http://www.weather.com.cn.data/cityinfo/&quot; + weatherCode + &quot;.html&quot;;

        HttpUtil.sendHttpRequest(address, new HttpCallbackListener() {
            @Override
            public void onFinish(String response) {
                Utility.handlerWeatherResponse(AutoUpdateService.this, response);
            }

            @Override
            public void onError(Exception e) {
                e.printStackTrace();
            }
        });
    }
}
</code></pre><h3 id="通过广播再次启动服务"><a href="#通过广播再次启动服务" class="headerlink" title="通过广播再次启动服务"></a>通过广播再次启动服务</h3><pre><code>package service;

import android.content.BroadcastReceiver;
import android.content.Context;
import android.content.Intent;

/**
 * Created by T on 2016/7/1.
 */

public class AutoUpdateReceiver extends BroadcastReceiver {
    @Override
    public void onReceive(Context context, Intent intent) {
        Intent i = new Intent(context, AutoUpdateService.class);
        context.startService(i);
    }
}
</code></pre><h3 id="其他工具类"><a href="#其他工具类" class="headerlink" title="其他工具类"></a>其他工具类</h3><pre><code>package util;

/**
 * 定义一个接口，用来回调服务返回的结果
 * Created by T on 2016/4/7.
 */
public interface HttpCallbackListener {

    void onFinish(String response);

    void onError(Exception e);
}
</code></pre><h4 id="访问网络获取数据的工具类"><a href="#访问网络获取数据的工具类" class="headerlink" title="访问网络获取数据的工具类"></a>访问网络获取数据的工具类</h4><pre><code>package util;

import android.content.Context;
import android.content.SharedPreferences;
import android.preference.PreferenceManager;
import android.util.Log;

import org.json.JSONException;
import org.json.JSONObject;

import java.io.BufferedReader;
import java.io.InputStream;
import java.io.InputStreamReader;
import java.net.HttpURLConnection;
import java.net.MalformedURLException;
import java.net.URL;
import java.text.SimpleDateFormat;
import java.util.Date;
import java.util.Locale;

/**
 * Created by T on 2016/4/7.
 */
public class HttpUtil {
    public static void sendHttpRequest(final String address, final HttpCallbackListener listener){
        new Thread(){
            @Override
            public void run() {
                HttpURLConnection connection = null;//定义一个HttpURLConnection对象

                try {
                    URL url = new URL(address);
                    connection = (HttpURLConnection) url.openConnection();//获取HttpURLConnection实例
                    connection.setRequestMethod(&quot;GET&quot;);//这是GET方法，从服务器获取数据
                    connection.setConnectTimeout(8000);//设置连接的时间
                    connection.setReadTimeout(8000);//设置读取时间
                    InputStream is = connection.getInputStream();
                    BufferedReader reader = new BufferedReader(new InputStreamReader(is));

                    StringBuilder response = new StringBuilder();
                    String line;

                    while ((line = reader.readLine()) != null){
                        response.append(line);
                    }

                    if (listener != null){
                        //回调onFinish()方法
                        Log.e(&quot;sendHttpResponse---&gt;&quot;,response.toString() + &quot;&quot;);
                        listener.onFinish(response.toString());
                    }
                } catch (Exception e) {
                    if (listener != null){
                        listener.onError(e);
                    }
                }finally {
                    if (connection != null){
                        connection.disconnect();
                    }
                }
            }
        }.start();
    }
}
</code></pre><h4 id="解析返回信息的工具类"><a href="#解析返回信息的工具类" class="headerlink" title="解析返回信息的工具类"></a>解析返回信息的工具类</h4><pre><code>package util;

import android.content.Context;
import android.content.SharedPreferences;
import android.graphics.Bitmap;
import android.preference.PreferenceManager;
import android.text.TextUtils;
import android.util.Log;

import org.json.JSONObject;

import java.text.SimpleDateFormat;
import java.util.Date;
import java.util.Locale;

import model.City;
import model.CoolWeatherDB;
import model.County;
import model.Province;

/**
 * 工具类，用来解析服务器返回的 省市县 的数据， 返回格式为 代号|城市，代号|城市
 * Created by T on 2016/4/7.
 */
public class Utility {

    /**
     * 解析从服务器解析返回的JSON数据，并将解析的数据保存到本地
     *
     * @param context
     * @param response
     */
    public static void handlerWeatherResponse(Context context, String response) {
        try {
            JSONObject jsonObject = new JSONObject(response);
            JSONObject weatherInfo = jsonObject.getJSONObject(&quot;weatherinfo&quot;);

            String cityName = weatherInfo.getString(&quot;city&quot;);
            String weatherCode = weatherInfo.getString(&quot;cityid&quot;);
            String temp1 = weatherInfo.getString(&quot;temp1&quot;);
            String temp2 = weatherInfo.getString(&quot;temp2&quot;);
            String weatherDesp = weatherInfo.getString(&quot;weather&quot;);
            String publishTime = weatherInfo.getString(&quot;ptime&quot;);
            String img = weatherInfo.getString(&quot;img2&quot;);

            saveWeatherInfo(context, cityName, weatherCode, temp1, temp2, weatherDesp, publishTime, img);
        } catch (Exception e) {
            e.printStackTrace();
        }
    }

    /**
     * 将服务器返回的所有天气信息存储到SharedPreferences文件中
     *  @param context
     * @param cityName
     * @param weatherCode
     * @param temp1
     * @param temp2
     * @param weatherDesp
     * @param publishTime
     * @param img
     */
    private static void saveWeatherInfo(Context context, String cityName, String weatherCode, String temp1, String temp2, String weatherDesp, String publishTime, String img) {

        SimpleDateFormat sdf = new SimpleDateFormat(&quot;yyyy年M月d日&quot;, Locale.CANADA);
        SharedPreferences.Editor editor = PreferenceManager.getDefaultSharedPreferences(context).edit();

        editor.putBoolean(&quot;city_selected&quot;, true);
        editor.putString(&quot;city_name&quot;, cityName);
        editor.putString(&quot;weather_code&quot;, weatherCode);
        editor.putString(&quot;temp1&quot;, temp1);
        editor.putString(&quot;temp2&quot;, temp2);
        editor.putString(&quot;weather_desp&quot;, weatherDesp);
        editor.putString(&quot;publish_time&quot;, publishTime);
        editor.putString(&quot;current_time&quot;, sdf.format(new Date()));
        editor.putString(&quot;img&quot;, img);
        editor.commit();
    }


    /**
     * 解析和处理服务器返回的省级数据
     *
     * @param coolWeatherDB
     * @param response
     * @return
     */
    public synchronized static boolean handleProvincesResponse(CoolWeatherDB coolWeatherDB, String response) {

        if (!TextUtils.isEmpty(response)) {
            String[] allProvinces = response.split(&quot;,&quot;);//第一层解析，创建一个String数组，接收解析出来的数据，

            if (allProvinces != null &amp;&amp; allProvinces.length &gt; 0) {
                for (String p : allProvinces) {
                    String[] array = p.split(&quot;\\|&quot;);//第二层解析，再创建一个String数组,分别存放 代号 和 城市

                    //创建一个Province对象，并将解析出来的数据分别给 code name 赋值
                    Province province = new Province();
                    province.setProvinceCode(array[0]);
                    province.setProvinceName(array[1]);

                    coolWeatherDB.saveProvince(province);//将从服务器解析出来的数据存储到本地数据库
                }
                return true;
            }
        }
        return false;
    }

    /**
     * 解析和处理服务器传回来的市级数据
     *
     * @param coolWeatherDB
     * @param response
     * @param provinceId    province的外键
     * @return
     */
    public static boolean handlerCitiesResponse(CoolWeatherDB coolWeatherDB, String response, int provinceId) {

        if (!TextUtils.isEmpty(response)) {
            String[] allCities = response.split(&quot;,&quot;);//第一层解析,创建一个String数组，接收解析出来的数据

            if (allCities != null &amp;&amp; allCities.length &gt; 0) {
                for (String c : allCities) {
                    String[] array = c.split(&quot;\\|&quot;);//第二层解析，创建一个String数组，接收解析出来的code 和 name

                    //创建一个City对象，并将解析出来的code name 赋值给实体类的变量
                    City city = new City();
                    city.setCityCode(array[0]);
                    city.setCityName(array[1]);
                    city.setProvinceId(provinceId);

                    coolWeatherDB.saveCity(city);//将从服务器解析出来的City数据保存到本地数据库
                }
                return true;
            }
        }
        return false;
    }

    /**
     * 处理和解析服务器返回的县级的数据
     *
     * @param coolWeatherDB
     * @param response
     * @param cityId
     * @return
     */
    public static boolean handlerCounties(CoolWeatherDB coolWeatherDB, String response, int cityId) {

        if (!TextUtils.isEmpty(response)) {
            String[] counties = response.split(&quot;,&quot;);//第一次解析

            if (counties != null &amp;&amp; counties.length &gt; 0) {
                for (String c : counties) {
                    String[] array = c.split(&quot;\\|&quot;);//第二层解析

                    County county = new County();
                    county.setCountyCode(array[0]);
                    county.setCountyName(array[1]);
                    county.setCityId(cityId);

                    coolWeatherDB.saveCounty(county);
                }
                return true;
            }
        }
        return false;
    }
}
</code></pre><h3 id="项目运行结果："><a href="#项目运行结果：" class="headerlink" title="项目运行结果："></a>项目运行结果：</h3><p><img src="/img/weather.png" alt="wearher展示"></p>
<h3 id="项目地址"><a href="#项目地址" class="headerlink" title="项目地址"></a>项目地址</h3><p><a href="https://github.com/OneTwoG/simpleWeather" target="_blank" rel="external">项目地址：https://github.com/OneTwoG/simpleWeather</a></p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
      
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/Android/">Android</a>
	</div>


      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-数据库基础" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/07/02/数据库基础/" class="article-date">
  	<time datetime="2016-07-02T07:51:13.774Z" itemprop="datePublished">2016-07-02</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/07/02/数据库基础/">数据库基础一</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="创建数据库"><a href="#创建数据库" class="headerlink" title="创建数据库"></a>创建数据库</h3><pre><code>create datebase 数据库名
</code></pre><h3 id="创建表"><a href="#创建表" class="headerlink" title="创建表"></a>创建表</h3><pre><code>create table person(
    id int primary key identity(1,1),
    name char(10) not null,
    age int not null,
    address varchar(140)
)
</code></pre><p>创建了一个person表，表里面的字段分别是id 姓名，年龄，地址。设置id为主键，并且初始为1，自动增长1，地址的最大长度为140。</p>
<h3 id="给表增加字段"><a href="#给表增加字段" class="headerlink" title="给表增加字段"></a>给表增加字段</h3><pre><code>alter table person add gender char(2)
</code></pre><p>给person增加一个性别的字段</p>
<h3 id="插入"><a href="#插入" class="headerlink" title="插入"></a>插入</h3><pre><code>insert into person values(&apos;李斯&apos;, 20， &apos;北京天安门&apos;)
</code></pre><h3 id="修改"><a href="#修改" class="headerlink" title="修改"></a>修改</h3><pre><code>update person set age = 22 where name = &apos;李斯&apos;
</code></pre><h3 id="查询"><a href="#查询" class="headerlink" title="查询"></a>查询</h3><pre><code>select * from person
</code></pre><p>查出person的所有数据</p>
<h3 id="删除"><a href="#删除" class="headerlink" title="删除"></a>删除</h3><pre><code>delete from person where age = 22
</code></pre><p>删除年龄为22的数据</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
      
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/数据库/">数据库</a>
	</div>


      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-Java读取txt文件" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/06/15/Java读取txt文件/" class="article-date">
  	<time datetime="2016-06-14T16:00:00.000Z" itemprop="datePublished">2016-06-15</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/06/15/Java读取txt文件/">Java读取txt文件，并对读取字符串进行求和操作</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>题目： 从一个txt文件中读取其中的数据。txt文本数据示例如下<br>8<br>1 2 3 4 5 6<br>读取之后分别求出奇数和 偶数和</p>
<p>实例代码</p>
<pre><code>import java.io.FileReader;
class test{
public static void main(String[] args) {

    String getNum = &quot;&quot;;


    FileReader readFile = null;

    try{
        readFile = new FileReader(&quot;test.txt&quot;);

        int ch;

        while ((ch = readFile.read()) != -1) {
//                System.out.print((char)ch);
            getNum += (char)ch;
        }
    }catch(Exception e){
        e.printStackTrace();
    }finally {
        try{
            if(readFile != null) readFile.close();
        }catch(Exception e){
            e.printStackTrace();
        }
    }

    System.out.println(getNum);


    int sumOdd = 0;
    int sumEven = 0;

    for (int i = 2; i &lt; getNum.length(); i+=2) {
//            int temp = getNum.charAt(i) - &apos;0&apos;;
        int temp = Integer.parseInt(String.valueOf(getNum.charAt(i)));
        System.out.println(temp);
        if( temp % 2 == 0 ){
            sumEven += temp;
        }else {
            sumOdd += temp;
        }
    }

    System.out.println(&quot;奇数和：&quot; + sumOdd);
    System.out.println(&quot;偶数和：&quot; + sumEven);
}
}
</code></pre><p><strong>程序运行结果</strong><br><img src="http://139.129.39.66/blog/JavaReadTxt.png" alt="result"></p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
      
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/Java基础/">Java基础</a>
	</div>


      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-Cocos2d-x" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/06/10/Cocos2d-x/" class="article-date">
  	<time datetime="2016-06-09T16:00:00.000Z" itemprop="datePublished">2016-06-10</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/06/10/Cocos2d-x/">Cocos2d-x 2048小游戏</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>通过Cocos2d-x游戏引擎 制作2048小游戏，主要用C++实现<br><strong>开发步骤</strong></p>
<ul>
<li>创建CardSplite类</li>
<li>设计主游戏场景GameScene，实现游戏逻辑，添加动画逻辑。</li>
<li>添加游戏胜利或者游戏失败显示  </li>
</ul>
<p><strong>主要实现代码</strong></p>
<p><strong>CardSplit类</strong></p>
<pre><code>#include &quot;CardSprite.h&quot;
USING_NS_CC;
//初始化游戏卡片的方法
CardSprite* CardSprite::createCardSprite(int number, int weight, int height, float CardSpriteX, float CardSpriteY)
{
CardSprite *enemy = new CardSprite();
if (enemy &amp;&amp; enemy-&gt;init())
{
    enemy-&gt;autorelease();
    enemy-&gt;enemyInit(number, weight, height, CardSpriteX, CardSpriteY);

    return enemy;
}

CC_SAFE_DELETE(enemy);
return NULL;
}
bool CardSprite::init()
{
if (!Sprite::init())
{
    return false;
}
return true;
}

//设置数字
void CardSprite::setNumber(int num) {
number = num;

//判断数字的大小来调整字体的大小
if (number &gt;= 0)
{
    labTTCardNumber-&gt;setFontSize(30);
}
if (number &gt;= 16)
{
    labTTCardNumber-&gt;setFontSize(30);
}
if (number &gt;= 128)
{
    labTTCardNumber-&gt;setFontSize(30);
}
if (number &gt;= 1024)
{
    labTTCardNumber-&gt;setFontSize(25);
}

//判断数字的大小调整颜色
if (number == 0)
{
    layerCardBG-&gt;setColor(cocos2d::Color3B(222, 184, 135));
}
if (number == 2)
{
    layerCardBG-&gt;setColor(cocos2d::Color3B(173, 216, 230));
}
if (number == 4)
{
    layerCardBG-&gt;setColor(cocos2d::Color3B(127, 255, 0));
}
if (number == 8)
{
    layerCardBG-&gt;setColor(cocos2d::Color3B(34, 139, 34));
}
if (number == 16)
{
    layerCardBG-&gt;setColor(cocos2d::Color3B(255, 20, 147));
}
if (number == 32)
{
    layerCardBG-&gt;setColor(cocos2d::Color3B(240, 120, 90));
}
if (number == 64)
{
    layerCardBG-&gt;setColor(cocos2d::Color3B(240, 90, 60));
}
if (number == 128)
{
    layerCardBG-&gt;setColor(cocos2d::Color3B(240, 90, 60));
}
if (number == 256)
{
    layerCardBG-&gt;setColor(cocos2d::Color3B(240, 200, 70));
}
if (number == 512)
{
    layerCardBG-&gt;setColor(cocos2d::Color3B(240, 200, 70));
}
if (number == 1024)
{
    layerCardBG-&gt;setColor(cocos2d::Color3B(0, 130, 0));
}
if (number == 2048)
{
    layerCardBG-&gt;setColor(cocos2d::Color3B(0, 130, 0));
}

//更新显示数字,
if (number &gt; 0)
{
    labTTCardNumber-&gt;setString(__String::createWithFormat(&quot;%i&quot;, number)-&gt;getCString());
}
else
{
    labTTCardNumber-&gt;setString(&quot;&quot;);
}
}

//获取数字
int CardSprite::getNumber() {
return number;
}

void CardSprite::enemyInit(int numbers, int weight, int height, float CardSpriteX, float CardSpriteY) {
//初始化数字
number = numbers;

//加入卡片的背景颜色
layerCardBG = cocos2d::LayerColor::create(cocos2d::Color4B(200, 190, 280, 255), weight - 15, height - 15);
//设置位置
layerCardBG-&gt;setPosition(Point(CardSpriteX, CardSpriteY));

//判断如果不等于0 就显示，否则为空
if (number &gt; 0)
{
    //加入中间字体
    labTTCardNumber = cocos2d::LabelTTF::create(__String::createWithFormat(&quot;%i&quot;, number)-&gt;getCString(), &quot;hirakakuProN-w6&quot;, 100);
    //将字体设置到颜色块的正中间
    labTTCardNumber-&gt;setPosition(Point(layerCardBG-&gt;getContentSize().width / 2, layerCardBG-&gt;getContentSize().height / 2));

    layerCardBG-&gt;addChild(labTTCardNumber);
}
else
{
    //加入中间字体
    labTTCardNumber = cocos2d::LabelTTF::create(&quot;&quot;, &quot;hirakakuProN-w6&quot;, 100);
    //将字体设置到颜色块的正中间
    labTTCardNumber-&gt;setPosition(Point(layerCardBG-&gt;getContentSize().width / 2, layerCardBG-&gt;getContentSize().height / 2));

    layerCardBG-&gt;addChild(labTTCardNumber);
}

//加入背景
 this-&gt;addChild(layerCardBG);
}
//获得卡片层
LayerColor* CardSprite::getCardLayer()
{
     return layerCardBG;
}
</code></pre><p><strong>HelloWorld类</strong></p>
<pre><code>#include &quot;HelloWorldScene.h&quot;
#include &quot;CardSprite.h&quot;

USING_NS_CC;

Scene* HelloWorld::createScene()
{
    auto scene = Scene::create();
    auto layer = HelloWorld::create();
    scene-&gt;addChild(layer);

    return scene;
}

// on &quot;init&quot; you need to initialize your instance
bool HelloWorld::init()
{
if (!Layer::init())
{
    return false;
}

//分数初始化
score = 0;

Size visibleSize = Director::getInstance()-&gt;getVisibleSize();
Vec2 origin = Director::getInstance()-&gt;getVisibleOrigin();

//加入游戏背景
auto layerColorBG = cocos2d::LayerColor::create(cocos2d::Color4B(180, 170, 160, 255));
this-&gt;addChild(layerColorBG);

//加入游戏标题  
auto title = LabelTTF::create(&quot;2048&quot;, &quot;Arial&quot;, 60);
title-&gt;setColor(Color3B(255, 255, 153));
title-&gt;setPosition(Point(visibleSize.width / 2, visibleSize.height - 50));
addChild(title);

//加入restart按钮  
restartBtn = LabelTTF::create(&quot;Restart&quot;, &quot;Arial&quot;, 20);
restartBtn-&gt;setColor(Color3B(204, 255, 253));
restartBtn-&gt;setPosition(Point(visibleSize.width / 2, visibleSize.height - 110));
this-&gt;addChild(restartBtn);

//给restartBtn设置事件监听器
auto listener = EventListenerTouchOneByOne::create();
listener-&gt;onTouchBegan = [](Touch *t, Event *e)
{
    if (e-&gt;getCurrentTarget()-&gt;getBoundingBox().containsPoint(t-&gt;getLocation()))
    {
        Director::getInstance()-&gt;replaceScene(TransitionFade::create(1, HelloWorld::createScene()));
    }
    return false;
};
Director::getInstance()-&gt;getEventDispatcher()-&gt;addEventListenerWithSceneGraphPriority(listener, restartBtn);

//在游戏上方加入显示分数的控件
auto labTTfCardNumberName = LabelTTF::create(&quot;Score&quot;,&quot;Arial&quot;, 30);
labTTfCardNumberName-&gt;setPosition(visibleSize.width / 5, visibleSize.height -150);
addChild(labTTfCardNumberName);

//在游戏上方加入显示分数的控件
labTTFScore = LabelTTF::create(&quot;0&quot;, &quot;Arial&quot;, 30);
labTTFScore-&gt;setPosition(visibleSize.width / 2 + 100, visibleSize.height - 150);
addChild(labTTFScore);

//加入aboutMe控件  
aboutMe = MenuItemImage::create(&quot;About.png&quot;, &quot;About.png&quot;, CC_CALLBACK_1(HelloWorld::menuAboutMe, this));
aboutMe-&gt;setColor(Color3B(204, 255, 253));
aboutMe-&gt;setPosition(Vec2(origin.y + aboutMe-&gt;getContentSize().width / 2,
    origin.y + aboutMe-&gt;getContentSize().height / 2));

//创建一个退出游戏按钮
auto closeItem = MenuItemImage::create(
    &quot;CloseNormal.png&quot;,
    &quot;CloseSelected.png&quot;,
    CC_CALLBACK_1(HelloWorld::menuCloseCallback, this));
closeItem-&gt;setPosition(Vec2(origin.x + visibleSize.width - closeItem-&gt;getContentSize().width / 2,
    origin.y + closeItem-&gt;getContentSize().height / 2));

// create menu, it&apos;s an autorelease object
auto menu = Menu::create(closeItem, aboutMe, NULL);
menu-&gt;setPosition(Vec2::ZERO);
this-&gt;addChild(menu, 1);

//加入游戏手势识别的事件监听，进行绑定
auto touchListener = EventListenerTouchOneByOne::create();
touchListener-&gt;onTouchBegan = CC_CALLBACK_2(HelloWorld::onTouchBegan, this);
touchListener-&gt;onTouchEnded = CC_CALLBACK_2(HelloWorld::onTouchEnded, this);
_eventDispatcher-&gt;addEventListenerWithSceneGraphPriority(touchListener, this);

//调用生成卡片的方法
createCardSprite(visibleSize);

//调用生成随机数方法,初始化生成两个数字
autoCreateCardNumber();
autoCreateCardNumber();
return true;
}

//关于
void HelloWorld::menuAboutMe(cocos2d::Ref* pSender)
{
if (isShow)
{
    Size visibleSize = Director::getInstance()-&gt;getVisibleSize();
    menuAuthor = LabelTTF::create(String::createWithFormat(&quot;Author:YTW&quot;)-&gt;getCString(), &quot;hirakakuProN-w6&quot;, 25);
    menuAuthor-&gt;setPosition(visibleSize.width / 2, visibleSize.height / 2 + 30);
    menuAuthor-&gt;setColor(Color3B(48, 48, 48));
    addChild(menuAuthor);

    menuVersion = LabelTTF::create(String::createWithFormat(&quot;Version:1.0&quot;)-&gt;getCString(), &quot;hirakakuProN-w6&quot;, 20);
    menuVersion-&gt;setPosition(visibleSize.width / 2, visibleSize.height / 2 - 30);
    menuVersion-&gt;setColor(Color3B(48, 48, 48));
    addChild(menuVersion);

    menuConnect = LabelTTF::create(String::createWithFormat(&quot;mail box:YQQQ@outlook.com&quot;)-&gt;getCString(), &quot;hirakakuProN-w6&quot;, 20);
    menuConnect-&gt;setPosition(visibleSize.width / 2, visibleSize.height / 2);
    menuConnect-&gt;setColor(Color3B(48, 48, 48));
    addChild(menuConnect);

    isShow = false;
}
else
{        
    menuAuthor-&gt;setVisible(false);
    menuConnect-&gt;setVisible(false);
    menuVersion-&gt;setVisible(false);

    isShow = true;
}

}

//游戏退出
void HelloWorld::menuCloseCallback(cocos2d::Ref* pSender)
{
    Director::getInstance()-&gt;end();
    exit(0);

}

//创建卡片
void HelloWorld::createCardSprite(cocos2d::Size size)
{
//求出单元格的宽度和高度
int lon = (size.width - 20) / 4;

//4*4的单元格
for (int i = 0; i &lt; 4; i++)
{
    for (int j = 0; j &lt; 4; j++)
    {
        CardSprite *card = CardSprite::createCardSprite(0, lon + 12, lon + 12, lon*i + 12, lon*j + 12 + size.height / 6);
        addChild(card);

        //将卡片添加到二维数组里面
        cardArray[i][j] = card;
    }
}

//创建临时卡片矩阵，用于动画，每个动画卡片对应一个实际卡片的动画，这是个技巧,并且动画层在卡片层之上，所以后加入，也可以设置addchild层次
for (int i = 0; i &lt; 4; i++)
{
    for (int j = 0; j &lt; 4; j++)
    {
        //最左边留白12，最下面留白size.height/6
        CardSprite *card = CardSprite::createCardSprite(0, lon, lon, lon*i + 12, lon*j + 12 + size.height / 6);
        this-&gt;addChild(card);
        cardArrAction[i][j] = card;
        //一开始把这层全部隐藏
        auto hide = Hide::create();
        cardArrAction[i][j]-&gt;getCardLayer()-&gt;runAction(hide);
    }
}
}

void HelloWorld::autoCreateCardNumber()
{
int i = CCRANDOM_0_1() * 4;
int j = CCRANDOM_0_1() * 4;

//判断是否是已经存在的位置
if (cardArray[i][j]-&gt;getNumber() &gt; 0)
{
    //如果大于0，说明这个格子已经存在数字,再次回调自己
    autoCreateCardNumber();
}
else
{
    //给cardArray[i][j]随机生成一个数字，如果生成的数字小于1的话就给格子赋值4，否则是2
    cardArray[i][j]-&gt;setNumber(CCRANDOM_0_1() * 10 &lt; 1 ? 4 : 2);

    //用动画效果生成
    auto action = Sequence::createWithTwoActions(ScaleTo::create(0, 0), ScaleTo::create(0.3f, 1));  //在0.3秒内从小缩放到大
    cardArray[i][j]-&gt;getCardLayer()-&gt;runAction(action);  //用卡片的层而不是卡片精灵本身做动作是为了使用局部坐标缩放
}
}

bool HelloWorld::onTouchBegan(cocos2d::Touch *touch, cocos2d::Event *unused_event)
{
//得到坐标
Point touch0 = touch-&gt;getLocation();

//获取初始的x y 坐标
firstX = touch0.x;
firstY = touch0.y;

return true;
}

void HelloWorld::restart(Ref* sender)
{
    //转场，重新开始游戏
    Director::getInstance()-&gt;replaceScene(TransitionFade::create(0.7f, HelloWorld::createScene()));
}

void HelloWorld::onTouchEnded(cocos2d::Touch *touch, cocos2d::Event *unused_event)
{
//获取X Y 轴的移动范围
Point touchP0 = touch-&gt;getLocation();
endX = firstX - touchP0.x;
endY = firstY - touchP0.y;

//判断 X轴 跟 Y轴的移动距离，如果X的绝对值大于Y轴的绝对值就是左右移动，否则上下移动
if (abs(endX) &gt; abs(endY))
{
    if (endX - 5 &gt; 0)
    {
        //左边
        if (doLeft())
        {
            autoCreateCardNumber();
            doCheckGameOver();
        }
    }
    else
    {
        //右边
        if (doRight())
        {
            autoCreateCardNumber();
            doCheckGameOver();
        }
    }
}
else
{
    if (endY - 5 &gt; 0)
    {
        //下边
        if (doDown())
        {
            autoCreateCardNumber();
            doCheckGameOver();
        }
    }
    else
    {
        //上边
        if (doUp())
        {
            autoCreateCardNumber();
            doCheckGameOver();
        }
    }
}
}

//判断游戏是否结束
void HelloWorld::doCheckGameOver()
{
bool isGameOver = true;

for (int i = 0; i &lt; 4; i++)
{
    for (int j = 0; j &lt; 4; j++)
    {
        if (cardArray[i][j]-&gt;getNumber() == 0
            || (i &gt; 0 &amp;&amp; (cardArray[i][j])-&gt;getNumber() == cardArray[i - 1][j]-&gt;getNumber())
            || (i &lt; 3 &amp;&amp; (cardArray[i][j])-&gt;getNumber() == cardArray[i + 1][j]-&gt;getNumber())
            || (j &gt; 0 &amp;&amp; (cardArray[i][j])-&gt;getNumber() == cardArray[i][j - 1]-&gt;getNumber()
            || (j &lt; 3 &amp;&amp; (cardArray[i][j])-&gt;getNumber() == cardArray[i][j + 1]-&gt;getNumber())))
        {
            isGameOver = false;
        }
    }
}

if (isGameOver)
{
    //获取屏幕大小
    Size visibleSize = Director::getInstance()-&gt;getVisibleSize();

    //结束时隐藏游戏界面的restartBtn
    restartBtn-&gt;setVisible(false);

    //创建菜单
    auto menuTitle = LabelTTF::create(String::createWithFormat(&quot;Game Over&quot;)-&gt;getCString(), &quot;Arial&quot;, 40);
    menuTitle-&gt;setPosition(visibleSize.width / 2, visibleSize.height / 2 + 50);
    menuTitle-&gt;setColor(Color3B(48, 48, 48));
    addChild(menuTitle);

    auto menuScoreLabel = LabelTTF::create(String::createWithFormat(&quot;Score: %d&quot;, score)-&gt;getCString(), &quot;Arial&quot;, 25);
    menuScoreLabel-&gt;setPosition(visibleSize.width / 2, visibleSize.height / 2 - 30);
    menuScoreLabel-&gt;setColor(Color3B(48, 48, 48));
    addChild(menuScoreLabel);

    auto item1 = MenuItemFont::create(&quot;Restart&quot;, CC_CALLBACK_1(HelloWorld::menuCallback, this));
    item1-&gt;setPosition(Vec2(visibleSize.width / 2, visibleSize.height / 3));
    item1-&gt;setColor(Color3B(255, 255,0));

    auto menu = Menu::create(item1, NULL);
    menu-&gt;setAnchorPoint(Vec2::ZERO);
    menu-&gt;setPosition(Vec2::ZERO);
    this-&gt;addChild(menu);
}
}

//点击菜单中的restart会
void HelloWorld::menuCallback(cocos2d::Ref* pSender)
{
Director::getInstance()-&gt;replaceScene(TransitionFade::create(1, HelloWorld::createScene()));
}

bool HelloWorld::doLeft()
{
bool isdo = false;

//计算移动的步进间距
auto cardSize = (Director::getInstance()-&gt;getVisibleSize().width - 5 * 4) / 4;
for (int i = 0; i &lt; 4; i++)
{
    for (int j = 0; j &lt; 4; j++)
    {
        //这层循环用于判断每个块
        for (int l = j + 1; l &lt; 4; l++)
        {
            if (cardArray[l][i]-&gt;getNumber() &gt; 0)//判断卡片里面的数字是否大于0
            {
                if (cardArray[j][i]-&gt;getNumber() &lt;= 0)
                {
                    //专门弄一个动画层卡片实现定位、显现、移动、隐藏系列动画
                    auto place = Place::create(Point(cardSize*l + 12, cardSize*i + 12 + Director::getInstance()-&gt;getVisibleSize().height / 6));
                    cardArrAction[l][i]-&gt;setNumber(cardArray[l][i]-&gt;getNumber());  //每次都重新把动画卡片重新定位到实际对应的卡片位置，并设置相同的数字
                    auto show = Show::create();
                    auto move = MoveBy::create(0.1f, Point(-cardSize*(l - j), 0));  //注意移动的距离
                    auto hide = Hide::create();
                    cardArrAction[l][i]-&gt;getCardLayer()-&gt;runAction(Sequence::create(place, show, move, hide, NULL));

                    //如果x位置是空卡片，就把x1卡片移到x处，x1处变成空卡片
                    cardArray[j][i]-&gt;setNumber(cardArray[l][i]-&gt;getNumber());//给左边的 格子赋值
                    cardArray[l][i]-&gt;setNumber(0);//清空右边的格子

                    j--;
                    isdo = true;
                }//如果两只数字相等就合并
                else if (cardArray[j][i]-&gt;getNumber() == cardArray[l][i]-&gt;getNumber())
                {
                    auto place = Place::create(Point(cardSize*l + 12, cardSize*i + 12 + Director::getInstance()-&gt;getVisibleSize().height / 6));
                    cardArrAction[l][i]-&gt;setNumber(cardArray[l][i]-&gt;getNumber());
                    auto show = Show::create();
                    auto move = MoveBy::create(0.1f, Point(-cardSize*(l - j), 0));  //注意移动的距离
                    auto hide = Hide::create();
                    cardArrAction[l][i]-&gt;getCardLayer()-&gt;runAction(Sequence::create(place, show, move, hide, NULL));

                    //如果x位置是空卡片，就把x1卡片移到x处，x1处变成空卡片
                    cardArray[j][i]-&gt;setNumber(cardArray[j][i]-&gt;getNumber() * 2);
                    cardArray[l][i]-&gt;setNumber(0);

                    //数字合并动画
                    auto merge = Sequence::create(ScaleTo::create(0.1f, 1.2f), ScaleTo::create(0.1f, 1.0f), NULL);
                    cardArray[j][i]-&gt;getCardLayer()-&gt;runAction(merge);

                    //数字发生合并，添加分数
                    score += cardArray[j][i]-&gt;getNumber();
                    labTTFScore-&gt;setString(__String::createWithFormat(&quot;%i&quot;, score)-&gt;getCString());

                    isdo = true;
                }
                break;
            }
        }
    }
}
return isdo;
}

bool HelloWorld::doRight()
{
bool isdo = false;

//计算移动的步进间距
auto cardSize = (Director::getInstance()-&gt;getVisibleSize().width - 5 * 4) / 4;
for (int i = 0; i &lt; 4; i++)
{
    for (int j = 3; j &gt;= 0; j--)
    {
        //这层循环用于判断每个块
        for (int l = j - 1; l &gt;= 0; l--) 
        {
            if (cardArray[l][i]-&gt;getNumber() &gt; 0)//判断卡片里面的数字是否大于0
            {
                if (cardArray[j][i]-&gt;getNumber() &lt;= 0)
                {
                    //专门弄一个动画层卡片实现定位、显现、移动、隐藏系列动画
                    auto place = Place::create(Point(cardSize*l + 12, cardSize*i + 12 + Director::getInstance()-&gt;getVisibleSize().height / 6));
                    cardArrAction[l][i]-&gt;setNumber(cardArray[l][i]-&gt;getNumber());  //每次都重新把动画卡片重新定位到实际对应的卡片位置，并设置相同的数字
                    auto show = Show::create();
                    auto move = MoveBy::create(0.1f, Point(-cardSize*(l - j), 0));  //注意移动的距离
                    auto hide = Hide::create();
                    cardArrAction[l][i]-&gt;getCardLayer()-&gt;runAction(Sequence::create(place, show, move, hide, NULL));

                    cardArray[j][i]-&gt;setNumber(cardArray[l][i]-&gt;getNumber());//给左边的 格子赋值
                    cardArray[l][i]-&gt;setNumber(0);//清空右边的格子

                    j++;
                    isdo = true;
                }//如果两只数字相等就合并
                else if (cardArray[j][i]-&gt;getNumber() == cardArray[l][i]-&gt;getNumber())
                {
                    auto place = Place::create(Point(cardSize*l + 12, cardSize*i + 12 + Director::getInstance()-&gt;getVisibleSize().height / 6));
                    cardArrAction[l][i]-&gt;setNumber(cardArray[l][i]-&gt;getNumber());
                    auto show = Show::create();
                    auto move = MoveBy::create(0.1f, Point(-cardSize*(l - j), 0));  //注意移动的距离
                    auto hide = Hide::create();
                    cardArrAction[l][i]-&gt;getCardLayer()-&gt;runAction(Sequence::create(place, show, move, hide, NULL));

                    cardArray[j][i]-&gt;setNumber(cardArray[j][i]-&gt;getNumber() * 2);
                    cardArray[l][i]-&gt;setNumber(0);

                    //数字合并动画
                    auto merge = Sequence::create(ScaleTo::create(0.1f, 1.2f), ScaleTo::create(0.1f, 1.0f), NULL);
                    cardArray[j][i]-&gt;getCardLayer()-&gt;runAction(merge);

                    //数字发生合并，添加分数
                    score += cardArray[j][i]-&gt;getNumber();
                    labTTFScore-&gt;setString(__String::createWithFormat(&quot;%i&quot;, score)-&gt;getCString());

                    isdo = true;
                }
                break;
            }
        }
    }
}
return isdo;
}

bool HelloWorld::doUp()
{
bool isdo = false;

//计算移动的步进间距
auto cardSize = (Director::getInstance()-&gt;getVisibleSize().width - 5 * 4) / 4;
for (int j = 0; j &lt; 4; j++) 
{
    for (int i = 3; i &gt;= 0; i--) 
    {
        //这层循环用于判断每个块
        for (int l = i - 1; l &gt;= 0; l--) 
        {
            if (cardArray[j][l]-&gt;getNumber() &gt; 0)//判断卡片里面的数字是否大于0
            {
                if (cardArray[j][i]-&gt;getNumber() &lt;= 0)
                {
                    auto place = Place::create(Point(cardSize*j + 12, cardSize*l + 12 + Director::getInstance()-&gt;getVisibleSize().height / 6));
                    cardArrAction[j][l]-&gt;setNumber(cardArray[j][l]-&gt;getNumber());
                    auto show = Show::create();
                    auto move = MoveBy::create(0.1f, Point(0, -cardSize*(l - j)));  //注意移动的距离
                    auto hide = Hide::create();
                    cardArrAction[j][l]-&gt;getCardLayer()-&gt;runAction(Sequence::create(place, show, move, hide, NULL));

                    cardArray[j][i]-&gt;setNumber(cardArray[j][l]-&gt;getNumber());//给左边的 格子赋值
                    cardArray[j][l]-&gt;setNumber(0);//清空右边的格子

                    i++;
                    isdo = true;
                }//如果两只数字相等就合并
                else if (cardArray[j][i]-&gt;getNumber() == cardArray[j][l]-&gt;getNumber())
                {
                    auto place = Place::create(Point(cardSize*j + 12, cardSize*l + 12 + Director::getInstance()-&gt;getVisibleSize().height / 6));
                    cardArrAction[j][l]-&gt;setNumber(cardArray[j][l]-&gt;getNumber());
                    auto show = Show::create();
                    auto move = MoveBy::create(0.1f, Point(0, -cardSize*(l - j)));  //注意移动的距离
                    auto hide = Hide::create();
                    cardArrAction[j][l]-&gt;getCardLayer()-&gt;runAction(Sequence::create(place, show, move, hide, NULL));

                    cardArray[j][i]-&gt;setNumber(cardArray[j][l]-&gt;getNumber() * 2);
                    cardArray[j][l]-&gt;setNumber(0);

                    auto merge = Sequence::create(ScaleTo::create(0.1f, 1.2f), ScaleTo::create(0.1f, 1.0f), NULL);
                    cardArray[j][i]-&gt;getCardLayer()-&gt;runAction(merge);

                    //数字发生合并，添加分数
                    score += cardArray[j][i]-&gt;getNumber();
                    labTTFScore-&gt;setString(__String::createWithFormat(&quot;%i&quot;, score)-&gt;getCString());

                    isdo = true;
                }
                break;
            }
        }
    }
}
return isdo;
}    

bool HelloWorld::doDown()
{
bool isdo = false;

//计算移动的步进间距
auto cardSize = (Director::getInstance()-&gt;getVisibleSize().width - 5 * 4) / 4;
for (int j = 0; j &lt; 4; j++)
{
    for (int i = 0; i &lt; 4; i++)
    {
        //这层循环用于判断每个块
        for (int l = i + 1; l &lt; 4; l++)
        {
            if (cardArray[j][l]-&gt;getNumber() &gt; 0)//判断卡片里面的数字是否大于0
            {
                if (cardArray[j][i]-&gt;getNumber() &lt;= 0)
                {
                    auto place = Place::create(Point(cardSize*j + 12, cardSize*l + 12 + Director::getInstance()-&gt;getVisibleSize().height / 6));
                    cardArrAction[j][l]-&gt;setNumber(cardArray[j][l]-&gt;getNumber());
                    auto show = Show::create();
                    auto move = MoveBy::create(0.1f, Point(0, -cardSize*(l - j)));  //注意移动的距离
                    auto hide = Hide::create();
                    cardArrAction[j][l]-&gt;getCardLayer()-&gt;runAction(Sequence::create(place, show, move, hide, NULL));

                    cardArray[j][i]-&gt;setNumber(cardArray[j][l]-&gt;getNumber());//给左边的 格子赋值
                    cardArray[j][l]-&gt;setNumber(0);//清空右边的格子

                    i--;
                    isdo = true;
                }//如果两只数字相等就合并
                else if (cardArray[j][i]-&gt;getNumber() == cardArray[j][l]-&gt;getNumber())
                {
                    auto place = Place::create(Point(cardSize*j + 12, cardSize*l + 12 + Director::getInstance()-&gt;getVisibleSize().height / 6));
                    cardArrAction[j][l]-&gt;setNumber(cardArray[j][l]-&gt;getNumber());
                    auto show = Show::create();
                    auto move = MoveBy::create(0.1f, Point(0, -cardSize*(l - j)));  //注意移动的距离
                    auto hide = Hide::create();
                    cardArrAction[j][l]-&gt;getCardLayer()-&gt;runAction(Sequence::create(place, show, move, hide, NULL));

                    cardArray[j][i]-&gt;setNumber(cardArray[j][l]-&gt;getNumber() * 2);
                    cardArray[j][l]-&gt;setNumber(0);

                    auto merge = Sequence::create(ScaleTo::create(0.1f, 1.2f), ScaleTo::create(0.1f, 1.0f), NULL);
                    cardArray[j][i]-&gt;getCardLayer()-&gt;runAction(merge);

                    //数字发生合并，添加分数
                    score += cardArray[j][i]-&gt;getNumber();
                    labTTFScore-&gt;setString(__String::createWithFormat(&quot;%i&quot;, score)-&gt;getCString());

                    isdo = true;
                }
                break;//防止出现连续乘2
            }
        }
    }
}
return isdo;
}


//尝试输出中文，win32成功，android失败
//char* HelloWorld::G2U(const char* gb2312)
//{
//    int len = MultiByteToWideChar(CP_ACP, 0, gb2312, -1, NULL, 0);
//    wchar_t* wstr = new wchar_t[len + 1];
//    memset(wstr, 0, len + 1);
//    MultiByteToWideChar(CP_ACP, 0, gb2312, -1, wstr, len);
//    len = WideCharToMultiByte(CP_UTF8, 0, wstr, -1, NULL, 0, NULL, NULL);
//    char* str = new char[len + 1];
//    memset(str, 0, len + 1);
//    WideCharToMultiByte(CP_UTF8, 0, wstr, -1, str, len, NULL, NULL);
//    if (wstr) delete[] wstr;
//    return str;
//}
</code></pre><p><strong>关键点</strong><br>关键点：</p>
<p>1，专门弄了一个4*4的卡片临时矩阵做为动画层，也就是有16个卡片专门负责对应卡片的动画（卡片生成的动画是实际卡片，这个是例外）。</p>
<p>2，关于游戏逻辑中每次移动后面都有一个break</p>
<p><strong>成果展示</strong><br><img src="http://139.129.39.66/blog/2048One.png" alt="2048展示1"></p>
<p><img src="http://139.129.39.66/blog/2048End.png" alt="2048展示2"></p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
      
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/cocos2d-x/">cocos2d-x</a>
	</div>


      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-模板方法模式" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/06/03/模板方法模式/" class="article-date">
  	<time datetime="2016-06-03T09:20:34.000Z" itemprop="datePublished">2016-06-03</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/06/03/模板方法模式/">Android中的设计模式2</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="模板方法模式（Builder）"><a href="#模板方法模式（Builder）" class="headerlink" title="模板方法模式（Builder）"></a><strong>模板方法模式（Builder）</strong></h2><h3 id="模式的定义"><a href="#模式的定义" class="headerlink" title="模式的定义"></a><strong>模式的定义</strong></h3><p>定义一个操作中的算法的框架，而将一些步骤延时到子类中。使得子类可以不改变一个算法的结构即可以重定义该算法的某些特定步骤。  </p>
<h3 id="使用场景"><a href="#使用场景" class="headerlink" title="使用场景"></a><strong>使用场景</strong></h3><ul>
<li>多个子类有公有的方法，并且逻辑基本相同时。</li>
<li>重要、复杂的算法，可以把核心算法设计为模板方法，，周边的相关细节功能则由各个子类实现。</li>
<li>重构时，模板方法模式是一个经常使用的模式，把相同的代码抽取到父类中，然后通过子函数约束其行为。  </li>
</ul>
<h3 id="模式简单实现"><a href="#模式简单实现" class="headerlink" title="模式简单实现"></a><strong>模式简单实现</strong></h3><p>模板方法实际上是封装一个算法框架，就像是一套模板一样。而子类可以有不同的算法实现，在架构不被修改的情况下实现算法的替换。下面我们以开电脑这个动作来简单演示一下模板方法，开电脑的整过过程都是相对稳定的，首先打开电脑电源，电脑检测自身状态没有问题时将进入操作系统，对用户进行验证之后即可登录，下面我们使用模板方法来模拟一下这个过程。  </p>
<h3 id="实现源码"><a href="#实现源码" class="headerlink" title="实现源码"></a><strong>实现源码</strong></h3><pre><code>
/**
 * 抽象的Computer
 * @author T
 *
 */
public class AbstractComputer {

    protected void powerOn(){
        System.out.println(&quot;开启电源&quot;);
    }

    protected void checkHardware(){
        System.out.println(&quot;硬件检查&quot;);
    }

    protected void loadOS(){
        System.out.println(&quot;载入操作系统&quot;);
    }

    protected void login(){
        System.out.println(&quot;小白的电脑无验证，直接进入系统&quot;);
    }

    /**
     * 启动电脑方法，步骤固定为开启电源，系统检查，加载操作系统，用户登录。该方法为final，防止算法被串改
     */
    public final void startUp(){
        System.out.println(&quot;-----开机-----&quot;);
        powerOn();
        checkHardware();
        loadOS();
        login();
        System.out.println(&quot;-----开机  END-----&quot;);
    }
}


/**
 * 码农的计算机
 * @author T
 *
 */
public class CoderComputer extends AbstractComputer {

    @Override
    protected void login() {
        System.out.println(&quot;码农只需要进行用户和密码验证就可以了&quot;);
    }
}

/**
 * 军用计算机
 * @author T
 *
 */
public class MilitaryComputer extends AbstractComputer{

    @Override
    protected void checkHardware() {
        // TODO Auto-generated method stub
        super.checkHardware();
        System.out.println(&quot;检查硬件防火墙&quot;);
    }

    @Override
    protected void login() {
        // TODO Auto-generated method stub
        super.login();
        System.out.println(&quot;进行指纹识别等复杂的用户验证&quot;);
    }
}

import com.sun.org.apache.bcel.internal.classfile.Code;

public class Test {
    public static void main(String[] args) {
        AbstractComputer comp = new CoderComputer();
        comp.startUp();

        comp = new MilitaryComputer();
        comp.startUp();
    }
}
</code></pre><p>输出结果如图<br><img src="http://139.129.39.66/blog/fangfamoshi.png" alt="result"><br>通过上面的例子可以看到，在startUp方法中有一些固定的步骤，一次为开启电源、检查硬件、加载系统、用户登录四个步骤，这四个步骤是电脑开机过程中不会变动的四个过程。但是不同用户的这几个步骤的实现可能各不相同，因此他们可以用不同的实现。而startUp为final方法，即办证了算法框架不能修改，具体算法实现却可以灵活改变。startUp中的这几个算法步骤可以称为是一个套路，即可以称为模板方法。因此，模板方法是定义一个操作中的算法框架，而将一些步骤延迟到子类中。使得子类可以不改变一个算法的结构即可重定义该算法的某些特定步骤。  </p>
<h3 id="优点与缺点"><a href="#优点与缺点" class="headerlink" title="优点与缺点"></a><strong>优点与缺点</strong></h3><p><strong>优点</strong>  </p>
<ul>
<li>封装不变部分，扩展可变部分</li>
<li>提取公共部分代码，便可维护  </li>
</ul>
<p><strong>缺点</strong></p>
<ul>
<li>模板方法会带来代码阅读的难度，会让新手觉得难以理解</li>
</ul>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
      
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/Android/">Android</a>
	</div>


      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-基础强化之快速排序" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/06/02/基础强化之快速排序/" class="article-date">
  	<time datetime="2016-06-02T14:30:34.000Z" itemprop="datePublished">2016-06-02</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/06/02/基础强化之快速排序/">快速排序</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>快速排序基本思想：从需要排序的数组中选择其中一个作为基准元素（一般选择第一个或者最后一个）,然后利用基准元素对数组中的元素进行对比，通过这次比较可以将数组划分成两部分，第一部分是比基准元素小的（在基准元素左边），第二部分是比基准元素大的（在基准元素的右边）。此时基准元素就在这两部分之间。一次类推，再对分出来的这两部分进行递归各划分。  </p>
<p>选取74为基准元素<br><img src="http://139.129.39.66/blog/QuickSort.png" alt="过程演示">  </p>
<p><strong>实例代码</strong>  </p>
<pre><code>public class QuickSort{
public static void main (String[] args){
    int[] a = {74,24,44,13,85,67,32,90,34,23,55,77};

    System.out.println(&quot;排序之前&quot;);

    for(int i = 0; i &lt; a.length; i++){
        System.out.print(a[i] + &quot; &quot;);
    }

    //快速排序
    quick(a);
    System.out.println(&quot;排序之后&quot;);
    for(int i = 0; i &lt; a.length; i++){
        System.out.print(a[i] + &quot; &quot;);
    }

}

private static void quick(int[] a){
    if(a.length &gt; 0){
        quickSort(a, 0, a.length - 1);
    }
}

/**
*        递归函数
* int[] a  要进行排序的数组
* low      用于获取数组中的第一个数
* high     用户用户数组中的最后一个数 
**/
private static void quickSort(int[] a, int low, int high){
    if(low &lt; high){
        int middle = getMiddle(a, low, high);            //将数组进行划分，划分的结果如上图 最终结果
        quickSort(a, 0, middle - 1);        //对划分后的小于基准元素的数字进行排序
        quickSort(a, middle + 1, high);        //对划分后的大于基准元素的数字进行排序
    }
}

private static int getMiddle(int[] a, int low, int high){
    int temp = a[low];
    while(low &lt; high){        //用户判断是否结束


        //找到比基准元素小的元素位置
        while(low &lt; high &amp;&amp; a[high] &gt;= temp){        
            //从数组后面往前面比较，如果大于基准元素就继续进行下一个比较，否则跳出循环
            high--;
        }
        a[low] = a[high];        //跳出上面的循环后将数字进行交换


        //找到比基准元素大的元素位置
        while(low &lt; high &amp;&amp; a[low] &lt;= temp){        
            //从数组前面往后面比较，如果小于基准元素则继续进行下一个比较，否则跳出循环
            low++;
        }
        a[high] = a[low];        //跳出循环后将数字进行交换
    }
    a[low] = temp;                //将基准元素放数组中合适的位置
    return low;                    //返回基准元素的位置
}
</code></pre><p>}</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
      
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/排序算法/">排序算法</a>
	</div>


      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-单例设计模式" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/06/01/单例设计模式/" class="article-date">
  	<time datetime="2016-06-01T15:18:34.000Z" itemprop="datePublished">2016-06-01</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/06/01/单例设计模式/">Android中的设计模式1</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>设计模式代表了最佳的实践，通常被有经验的面向对象的软件开发人员所采用。设计模式已经成为开发人员最重要的技能之一，他们能够让你优雅的、简单、灵活的解决开发中遇到的设计难题，让你的软件系统具有更好的可扩展性、灵活性，在特定场景之下让你的软件系统实现拥抱变化。</p>
<h2 id="单例模式"><a href="#单例模式" class="headerlink" title="单例模式"></a>单例模式</h2><h3 id="单例模式定义"><a href="#单例模式定义" class="headerlink" title="单例模式定义"></a>单例模式定义</h3><p>确保某一个类中只有一个实例，而且自行实例化并向整个系统提供这个实例。  </p>
<h3 id="模式使用场景"><a href="#模式使用场景" class="headerlink" title="模式使用场景"></a>模式使用场景</h3><p>确保某个类有且只有一个对象的场景，例如创建一个对象需要消耗的资源过多，如要访问IO和数据库等资源。  </p>
<h3 id="模式的简单实现"><a href="#模式的简单实现" class="headerlink" title="模式的简单实现"></a>模式的简单实现</h3><p>单例模式是设计模式中最简单的，只有一个单例类，没有其他的层次结构与抽象。该模式需要确保该类只能生成一个对象，通常是该类需要消耗太多的资源或者没有多个实例的理由。例如一个公司只有一个CEO,一台电脑电脑通常只有一个键盘等。下面我们以公司里的CEO为例来简单演示，一个公司可以有几个VP，无数个员工，但是CEO只有一个，请看下面实例。  </p>
<h3 id="实现源码"><a href="#实现源码" class="headerlink" title="实现源码"></a>实现源码</h3><pre><code>
/**
 * 人的基类
 */
public abstract class Person {
    public abstract void talk();
}

/**
 * 普通员工
 */
public class Staff extends Person{

    @Override
    public void talk() {

    }
}

/**
 * 副总裁
 */
public class VP extends Person{

    @Override
    public void talk() {

    }
}

public class CEO extends Person{
    private static final CEO mCeo = new CEO();

    private CEO(){
    }

    public static CEO getCeo(){
        return mCeo;
    }

    @Override
    public void talk() {
        System.out.println(&quot;CEO发表讲话&quot;);
    }
}

/**
 * 公司类
 */
public class Company{
    private List&lt;Person&gt; allPerson = new ArrayList&lt;Person&gt;();

    public void addStaff(Person person){
        allPerson.add(person);
    }

    public void showALLStaffs(){
        for (Person per : allPerson){
            System.out.println(&quot;Obj:&quot; + per.toString());
        }
    }
}

public class Test{
    public static void main(String[] args){
        Company cp = new Company();
        Person ceo1 = CEO.getCeo();
        Person ceo2 = CEO.getCeo();
        cp.addStaff(ceo1);
        cp.addStaff(ceo2);

        Person vp1 = new VP();
        Person vp2 = new VP();

        Person staff1 = new Staff();
        Person staff2 = new Staff();
        Person staff3 = new Staff();

        cp.addStaff(vp1);
        cp.addStaff(vp2);
        cp.addStaff(staff1);
        cp.addStaff(staff2);
        cp.addStaff(staff3);

        cp.showALLStaffs();
    }
}
</code></pre><p>输出结果如图<br><img src="http://139.129.39.66/blog/danlimoshi.png" alt="显示结果">  </p>
<p>可以看到，CEO两次输出的CEO对象的文字描述都是一样的，而VP、Staff类的对象都是不同的。即CEO是唯一的实例，而其他类型都是不同的实例。这个实现的核心在于将CEO类的构造方法私有化，使得外部程序不能通过构造函数来构造CEO对象，而CEO类通过一个静态方法返回一个唯一的对象。  </p>
<h3 id="优点与缺点"><a href="#优点与缺点" class="headerlink" title="优点与缺点"></a>优点与缺点</h3><p><strong>优点</strong>  </p>
<ul>
<li>由于单例模式在内存中只有一个实例，减少了内存开支，特别是一个对象需要频繁地创建、销毁时，而且创建或销毁时性能又无法优化，单例模式的优势就非常明显  </li>
<li>由于单例模式只生成一个实例，所以减少了系统的性能开销，当一个对象的产生需要比较多的资源时，如读取配置、产生其他依赖对象时，则可以通过在应用启动时直接产生一个单例对象，然后用永久驻留内存的方式来解决；</li>
<li>单例模式可以避免对资源的多重占用，例如一个写文件动作，由于只有一个实例存在内存中，避免对同一个资源文件的同时写操作。</li>
<li>单例模式可以在系统设置全局的访问点，优化和共享资源访问，例如可以设计一个单例类，负责所有数据表的映射处理</li>
</ul>
<p><strong>缺点</strong></p>
<ul>
<li>单例模式一般没有接口，扩展很困难，若要扩展，除了修改代码基本上没有第二种途径可以实现。</li>
</ul>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
      
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/Android/">Android</a>
	</div>


      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-我的博客" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/05/28/我的博客/" class="article-date">
  	<time datetime="2016-05-28T14:18:34.000Z" itemprop="datePublished">2016-05-28</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/05/28/我的博客/">我的新博客</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>终于，我最后还是做了一个博客。 以后有时间会尽量在这写一些关于自己理解到的东西，我将在这里记录着我的失败与荣耀。 这是一个简单的开始。</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
      

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
  
</div>
      <footer id="footer">
  <div class="outer">
    <div id="footer-info">
    	<div class="footer-left">
    		&copy; 2016 会飞的僵尸
    	</div>
      	<div class="footer-right">
      		<a href="http://hexo.io/" target="_blank">Hexo</a>  Theme <a href="https://github.com/litten/hexo-theme-yilia" target="_blank">Yilia</a> by Litten
      	</div>
    </div>
  </div>
</footer>
    </div>
    
  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">


<script>
	var yiliaConfig = {
		fancybox: true,
		mathjax: true,
		animate: true,
		isHome: true,
		isPost: false,
		isArchive: false,
		isTag: false,
		isCategory: false,
		open_in_new: false,
		root: /
	}
</script>
<script src="http://7.url.cn/edu/jslib/comb/require-2.1.6,jquery-1.9.1.min.js"></script>
<script src="/js/main.js"></script>






<script type="text/x-mathjax-config">
MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
        processEscapes: true,
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    }
});

MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';                 
    }       
});
</script>

<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>


  </div>
</body>
</html>